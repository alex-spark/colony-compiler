/* WARNING: This file was automatically generated by lua2c. */

#ifdef __cplusplus
extern "C" {
#endif
#include <lua.h>
#include <lauxlib.h>
#include <lualib.h>
#ifdef __cplusplus
}
#endif
#include <stdio.h>
#include <stdlib.h>


#include <string.h>


/* pushes new closure table onto the stack, using closure table at
 * given index as its parent */
static void lc_newclosuretable(lua_State * L, int idx) {

  lua_newtable(L);
  lua_pushvalue(L,idx);
  lua_rawseti(L,-2,0);


}

#include <assert.h>

/* name: proto_get
 * function(self, proto, key) */
static int lcf1_proto_get (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc5 = 4 };
  assert((lua_gettop(L) == lc5));
  
  /* return rawget(proto, key) or (getmetatable(proto) and getmetatable(proto).__index and getmetatable(proto).__index(self, key)) or nil */
  lua_getglobal(L,"rawget");
  lua_pushvalue(L,2);
  lua_pushvalue(L,3);
  lua_call(L,2,1);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_getglobal(L,"getmetatable");
    lua_pushvalue(L,2);
    lua_call(L,1,1);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_getglobal(L,"getmetatable");
      lua_pushvalue(L,2);
      lua_call(L,1,1);
      lua_pushliteral(L,"__index");
      lua_gettable(L,-2);
      lua_remove(L,-2);
    }
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_getglobal(L,"getmetatable");
      lua_pushvalue(L,2);
      lua_call(L,1,1);
      lua_pushliteral(L,"__index");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_pushvalue(L,3);
      lua_call(L,2,1);
    }
  }
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnil(L);
  }
  return 1;
  assert(lua_gettop(L) == 4);
}


/* function () */
static int lcf7 (lua_State * L) {
  enum { lc_nformalargs = 0 };
  lua_settop(L,0);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc6 = 1 };
  assert((lua_gettop(L) == lc6));
  return 0;
}


/* gets upvalue with ID varid by consulting upvalue table at index
 * tidx for the upvalue table at given nesting level. */
static void lc_getupvalue(lua_State * L, int tidx, int level, int varid) {
  if (level == 0) {
    lua_rawgeti(L,tidx,varid);
  }
  else {
    lua_pushvalue(L,tidx);
    while (--level >= 0) {
      lua_rawgeti(L,tidx,0); /* 0 links to parent table */
      lua_remove(L,-2);
      tidx = -1;
    }
    lua_rawgeti(L,-1,varid);
    lua_remove(L,-2);
  }
}


/* function (self, key) */
static int lcf10 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc8 = 3 };
  assert((lua_gettop(L) == lc8));
  
  /* return proto_get(self, bool_proto, key) */
  const int lc9 = lua_gettop(L);
  lua_getglobal(L,"proto_get");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc8,1,6);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc9);
  assert(lua_gettop(L) == 3);
}


/* function (self, key) */
static int lcf13 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc11 = 3 };
  assert((lua_gettop(L) == lc11));
  
  /* return proto_get(self, num_proto, key) */
  const int lc12 = lua_gettop(L);
  lua_getglobal(L,"proto_get");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc11,1,5);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc12);
  assert(lua_gettop(L) == 3);
}


/* name: nil_mt.__tostring
 * function (arg) */
static int lcf1_nil_mt___tostring (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc14 = 2 };
  assert((lua_gettop(L) == lc14));
  
  /* return 'null' */
  lua_pushliteral(L,"null");
  return 1;
  assert(lua_gettop(L) == 2);
}


/* name: nil_mt.__eq
 * function (op1, op2) */
static int lcf1_nil_mt___eq (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc15 = 3 };
  assert((lua_gettop(L) == lc15));
  
  /* return op2 == nil */
  lua_pushvalue(L,2);
  lua_pushnil(L);
  const int lc16 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc16);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: nil_mt.__gt
 * function (op1, op2) */
static int lcf1_nil_mt___gt (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc17 = 3 };
  assert((lua_gettop(L) == lc17));
  
  /* return op2 == nil */
  lua_pushvalue(L,2);
  lua_pushnil(L);
  const int lc18 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc18);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: nil_mt.__lt
 * function (op1, op2) */
static int lcf1_nil_mt___lt (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc19 = 3 };
  assert((lua_gettop(L) == lc19));
  
  /* return op2 == nil */
  lua_pushvalue(L,2);
  lua_pushnil(L);
  const int lc20 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc20);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: mt.__index
 * function (self, key) */
static int lcf1_mt___index (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc22 = 3 };
  assert((lua_gettop(L) == lc22));
  
  /* return proto_get(self, obj_proto, key) */
  const int lc23 = lua_gettop(L);
  lua_getglobal(L,"proto_get");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc22,2,8);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc23);
  assert(lua_gettop(L) == 3);
}


/* __add metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_add(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) + lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__add")||luaL_getmetafield(L,idxb,"__add")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* name: objtostring
 * function(obj, sset) */
static int lcf1_objtostring (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc25 = 3 };
  assert((lua_gettop(L) == lc25));
  
  /* local vals = {} */
  lua_newtable(L);
  assert(lua_gettop(L) == 4);
  
  /* sset[obj] = true */
  lua_pushboolean(L,1);
  lua_pushvalue(L,1);
  lua_insert(L,-2);
  lua_settable(L,2);
  assert(lua_gettop(L) == 4);
  
  /* for k, v in pairs(obj) do
   * internal: local f, s, var = explist */
  enum { lc26 = 4 };
  lua_getglobal(L,"pairs");
  lua_pushvalue(L,1);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 8
     * internal: local v with idx 9 */
    
    
    /* if sset[v] ~= true then */
    enum { lc27 = 9 };
    lua_pushvalue(L,9);
    lua_gettable(L,2);
    lua_pushboolean(L,1);
    const int lc28 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc28);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
    const int lc29 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc29) {
      
      /* sset[v] = true */
      lua_pushboolean(L,1);
      lua_pushvalue(L,9);
      lua_insert(L,-2);
      lua_settable(L,2);
      assert(lua_gettop(L) == 9);
      
      /* if type(v) == 'string' then */
      enum { lc30 = 9 };
      lua_getglobal(L,"type");
      lua_pushvalue(L,9);
      lua_call(L,1,1);
      lua_pushliteral(L,"string");
      const int lc31 = lua_compare(L,-2,-1,LUA_OPEQ);
      lua_pop(L,2);
      lua_pushboolean(L,lc31);
      const int lc32 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc32) {
        
        /* v = '\'' + v + '\'' */
        lua_pushliteral(L,"'");
        lc_add(L,-1,9);
        lua_remove(L,-2);
        lua_pushliteral(L,"'");
        lc_add(L,-2,-1);
        lua_remove(L,-2);
        lua_remove(L,-2);
        lua_replace(L,9);
        assert(lua_gettop(L) == 9);
      }
      else {
        
        /* elseif type(v) == 'table' then */
        enum { lc33 = 9 };
        lua_getglobal(L,"type");
        lua_pushvalue(L,9);
        lua_call(L,1,1);
        lua_pushliteral(L,"table");
        const int lc34 = lua_compare(L,-2,-1,LUA_OPEQ);
        lua_pop(L,2);
        lua_pushboolean(L,lc34);
        const int lc35 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc35) {
          
          /* v = objtostring(v, sset) */
          lc_getupvalue(L,lc25,1,9);
          lua_pushvalue(L,9);
          lua_pushvalue(L,2);
          lua_call(L,2,1);
          lua_replace(L,9);
          assert(lua_gettop(L) == 9);
        }
        lua_settop(L,lc33);
      }
      lua_settop(L,lc30);
      assert(lua_gettop(L) == 9);
    }
    else {
      
      /* else
       * v = '[Circular]' */
      lua_pushliteral(L,"[Circular]");
      lua_replace(L,9);
      assert(lua_gettop(L) == 9);
    }
    lua_settop(L,lc27);
    assert(lua_gettop(L) == 9);
    
    /* if global.Array:isArray(obj) then */
    enum { lc36 = 9 };
    lc_getupvalue(L,lc25,4,2);
    lua_pushliteral(L,"Array");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"isArray");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,1);
    lua_call(L,2,1);
    const int lc37 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc37) {
      
      /* table.insert(vals, v) */
      lua_getglobal(L,"table");
      lua_pushliteral(L,"insert");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,4);
      lua_pushvalue(L,9);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 9);
    }
    else {
      
      /* else
       * table.insert(vals, k + ": " + v) */
      lua_getglobal(L,"table");
      lua_pushliteral(L,"insert");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,4);
      lua_pushliteral(L,": ");
      lc_add(L,8,-1);
      lua_remove(L,-2);
      lc_add(L,-1,9);
      lua_remove(L,-2);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 9);
    }
    lua_settop(L,lc36);
    assert(lua_gettop(L) == 9);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,lc26);
  assert(lua_gettop(L) == 4);
  
  /* if global.Array:isArray(obj) then */
  enum { lc38 = 4 };
  lc_getupvalue(L,lc25,4,2);
  lua_pushliteral(L,"Array");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"isArray");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,2,1);
  const int lc39 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc39) {
    
    /* if #vals == 0 then */
    enum { lc40 = 4 };
    lua_len(L,4);
    lua_pushnumber(L,0);
    const int lc42 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc42);
    const int lc43 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc43) {
      
      /* return "[]" */
      lua_pushliteral(L,"[]");
      return 1;
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc40);
    assert(lua_gettop(L) == 4);
    
    /* table.insert(vals, 1, table.remove(vals)) */
    lua_getglobal(L,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc44 = lua_gettop(L);
    lua_pushvalue(L,4);
    lua_pushnumber(L,1);
    lua_getglobal(L,"table");
    lua_pushliteral(L,"remove");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,4);
    lua_call(L,1,LUA_MULTRET);
    lua_call(L,(lua_gettop(L) - lc44),0);
    assert(lua_gettop(L) == 4);
    
    /* return "[ " + table.concat(vals, ", ") + " ]" */
    lua_pushliteral(L,"[ ");
    lua_getglobal(L,"table");
    lua_pushliteral(L,"concat");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,4);
    lua_pushliteral(L,", ");
    lua_call(L,2,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L," ]");
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  else {
    
    /* else
     * if #vals == 0 then */
    enum { lc45 = 4 };
    lua_len(L,4);
    lua_pushnumber(L,0);
    const int lc47 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc47);
    const int lc48 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc48) {
      
      /* return "{}" */
      lua_pushliteral(L,"{}");
      return 1;
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc45);
    assert(lua_gettop(L) == 4);
    
    /* return "{ " + table.concat(vals, ", ") + " }" */
    lua_pushliteral(L,"{ ");
    lua_getglobal(L,"table");
    lua_pushliteral(L,"concat");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,4);
    lua_pushliteral(L,", ");
    lua_call(L,2,1);
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L," }");
    lc_add(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc38);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: mt.__tostring
 * function (self) */
static int lcf1_mt___tostring (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc49 = 2 };
  assert((lua_gettop(L) == lc49));
  
  /* return objtostring(self, {}) */
  const int lc50 = lua_gettop(L);
  lc_getupvalue(L,lc49,1,9);
  lua_pushvalue(L,1);
  lua_newtable(L);
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc50);
  assert(lua_gettop(L) == 2);
}


/* name: global._obj
 * function (o) */
static int lcf1_global__obj (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc21 = 2 };
  assert((lua_gettop(L) == lc21));
  
  /* local mt = getmetatable(o) or {} */
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_newtable(L);
  }
  assert(lua_gettop(L) == 3);
  
  /* mt.__index = function (self, key)
   *     return proto_get(self, obj_proto, key)
   *   end */
  lua_pushvalue(L,lc21);
  lua_pushcclosure(L,lcf1_mt___index,1);
  lua_pushliteral(L,"__index");
  lua_insert(L,-2);
  lua_settable(L,3);
  assert(lua_gettop(L) == 3);
  
  /* local function objtostring (obj, sset)
   *     local vals = {}
   *     sset[obj] = true
   *     for k, v in pairs(obj) do
   *       if sset[v] ~= true then
   *         sset[v] = true
   *         if type(v) == 'string' then
   *           v = '\'' + v + '\''
   *         elseif type(v) == 'table' then
   *           v = objtostring(v, sset)
   *         end
   *       else
   *         v = '[Circular]'
   *       end
   *       if global.Array:isArray(obj) then
   *         table.insert(vals, v)
   *       else 
   *         table.insert(vals, k + ": " + v)
   *       end
   *     end
   *     if global.Array:isArray(obj) then
   *       if #vals == 0 then
   *         return "[]"
   *       end
   *       table.insert(vals, 1, table.remove(vals))
   *       return "[ " + table.concat(vals, ", ") + " ]"
   *     else
   *       if #vals == 0 then
   *         return "{}"
   *       end
   *       return "{ " + table.concat(vals, ", ") + " }"
   *     end
   *   end */
  lc_newclosuretable(L,lc21);
  enum { lc24 = 4 };
  assert((lua_gettop(L) == lc24));
  lua_pushvalue(L,lc24);
  lua_pushcclosure(L,lcf1_objtostring,1);
  lua_rawseti(L,lc24,9);
  assert(lua_gettop(L) == 4);
  
  /* mt.__tostring = function (self)
   *     return objtostring(self, {})
   *   end */
  lua_pushvalue(L,lc24);
  lua_pushcclosure(L,lcf1_mt___tostring,1);
  lua_pushliteral(L,"__tostring");
  lua_insert(L,-2);
  lua_settable(L,3);
  assert(lua_gettop(L) == 4);
  
  /* setmetatable(o, mt) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,1);
  lua_pushvalue(L,3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 4);
  
  /* return o */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: global._func
 * function (f) */
static int lcf1_global__func (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc51 = 2 };
  assert((lua_gettop(L) == lc51));
  
  /* return f */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 2);
}


/* function (this, ...) */
static int lcf56 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc53 = 2 };
  assert((lua_gettop(L) == (lc53 + lc_nextra)));
  
  /* return f(...) */
  const int lc54 = lua_gettop(L);
  lc_getupvalue(L,(lc53 + lc_nextra),1,10);
  const int lc55 = lua_gettop(L);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc55),LUA_MULTRET);
  return (lua_gettop(L) - lc54);
  assert(lua_gettop(L) - lc_nextra == 2);
}


/* name: luafunctor
 * function (f) */
static int lcf1_luafunctor (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc52 = 2 };
  assert((lua_gettop(L) == lc52));
  lua_pushvalue(L,1);
  lua_rawseti(L,-2,10);
  
  /* return (function (this, ...) return f(...) end) */
  lua_pushvalue(L,lc52);
  lua_pushcclosure(L,lcf56,1);
  return 1;
  assert(lua_gettop(L) == 2);
}


/* name: func_mt.__index
 * function (self, key) */
static int lcf1_func_mt___index (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc57 = 3 };
  assert((lua_gettop(L) == lc57));
  
  /* local fobj = funccache[self] */
  lua_getglobal(L,"funccache");
  lua_pushvalue(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  assert(lua_gettop(L) == 4);
  
  /* if key == 'prototype' then */
  enum { lc58 = 4 };
  lua_pushliteral(L,"prototype");
  const int lc59 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc59);
  const int lc60 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc60) {
    
    /* if fobj == nil then */
    enum { lc61 = 4 };
    lua_pushnil(L);
    const int lc62 = lua_compare(L,4,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc62);
    const int lc63 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc63) {
      
      /* funccache[self] = {} */
      lua_newtable(L);
      lua_getglobal(L,"funccache");
      lua_insert(L,-2);
      lua_pushvalue(L,1);
      lua_insert(L,-2);
      lua_settable(L,-3);
      lua_pop(L,1);
      assert(lua_gettop(L) == 4);
      
      /* fobj = funccache[self] */
      lua_getglobal(L,"funccache");
      lua_pushvalue(L,1);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_replace(L,4);
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc61);
    assert(lua_gettop(L) == 4);
    
    /* if fobj[key] == nil then */
    enum { lc64 = 4 };
    lua_pushvalue(L,2);
    lua_gettable(L,4);
    lua_pushnil(L);
    const int lc65 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc65);
    const int lc66 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc66) {
      
      /* fobj[key] = global._obj({}) */
      lc_getupvalue(L,lc57,2,2);
      lua_pushliteral(L,"_obj");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_newtable(L);
      lua_call(L,1,1);
      lua_pushvalue(L,2);
      lua_insert(L,-2);
      lua_settable(L,4);
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc64);
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc58);
  assert(lua_gettop(L) == 4);
  
  /* if fobj and fobj[key] ~= nil then */
  enum { lc67 = 4 };
  lua_pushvalue(L,4);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushvalue(L,2);
    lua_gettable(L,4);
    lua_pushnil(L);
    const int lc68 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc68);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
  }
  const int lc69 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc69) {
    
    /* return fobj[key] */
    lua_pushvalue(L,2);
    lua_gettable(L,4);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc67);
  assert(lua_gettop(L) == 4);
  
  /* return proto_get(self, func_proto, key) */
  const int lc70 = lua_gettop(L);
  lua_getglobal(L,"proto_get");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc57,1,7);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc70);
  assert(lua_gettop(L) == 4);
}


/* name: func_mt.__newindex
 * function (self, p, v) */
static int lcf1_func_mt___newindex (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc71 = 4 };
  assert((lua_gettop(L) == lc71));
  
  /* local pt = funccache[self] or {} */
  lua_getglobal(L,"funccache");
  lua_pushvalue(L,1);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_newtable(L);
  }
  assert(lua_gettop(L) == 5);
  
  /* pt[p] = v */
  lua_pushvalue(L,3);
  lua_pushvalue(L,2);
  lua_insert(L,-2);
  lua_settable(L,5);
  assert(lua_gettop(L) == 5);
  
  /* funccache[self] = pt */
  lua_pushvalue(L,5);
  lua_getglobal(L,"funccache");
  lua_insert(L,-2);
  lua_pushvalue(L,1);
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* name: func_mt.__tojson
 * function () */
static int lcf1_func_mt___tojson (lua_State * L) {
  enum { lc_nformalargs = 0 };
  lua_settop(L,0);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc72 = 1 };
  assert((lua_gettop(L) == lc72));
  
  /* return "{}" */
  lua_pushliteral(L,"{}");
  return 1;
  assert(lua_gettop(L) == 1);
}


/* name: str_mt.__index
 * function (str, p) */
static int lcf1_str_mt___index (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc73 = 3 };
  assert((lua_gettop(L) == lc73));
  
  /* if (p == "length") then */
  enum { lc74 = 3 };
  lua_pushliteral(L,"length");
  const int lc75 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc75);
  const int lc76 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc76) {
    
    /* return string.len(str) */
    const int lc77 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"len");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc77);
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* elseif (tonumber(p) == p) then */
    enum { lc78 = 3 };
    lua_getglobal(L,"tonumber");
    lua_pushvalue(L,2);
    lua_call(L,1,1);
    const int lc79 = lua_compare(L,-1,2,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc79);
    const int lc80 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc80) {
      
      /* return string.sub(str, p+1, p+1) */
      const int lc81 = lua_gettop(L);
      lua_getglobal(L,"string");
      lua_pushliteral(L,"sub");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_pushnumber(L,1);
      lc_add(L,2,-1);
      lua_remove(L,-2);
      lua_pushnumber(L,1);
      lc_add(L,2,-1);
      lua_remove(L,-2);
      lua_call(L,3,LUA_MULTRET);
      return (lua_gettop(L) - lc81);
      assert(lua_gettop(L) == 3);
    }
    else {
      
      /* else
       * return proto_get(str, str_proto, p) */
      const int lc82 = lua_gettop(L);
      lua_getglobal(L,"proto_get");
      lua_pushvalue(L,1);
      lc_getupvalue(L,lc73,1,4);
      lua_pushvalue(L,2);
      lua_call(L,3,LUA_MULTRET);
      return (lua_gettop(L) - lc82);
      assert(lua_gettop(L) == 3);
    }
    lua_settop(L,lc78);
  }
  lua_settop(L,lc74);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: str_mt.__add
 * function (op1, op2) */
static int lcf1_str_mt___add (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc83 = 3 };
  assert((lua_gettop(L) == lc83));
  
  /* return op1 .. tostring(op2) */
  lua_pushvalue(L,1);
  lua_getglobal(L,"tostring");
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_concat(L,2);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* function (arr, key) */
static int lcf94 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc85 = 3 };
  assert((lua_gettop(L) == lc85));
  
  /* if (key == "length") then */
  enum { lc86 = 3 };
  lua_pushliteral(L,"length");
  const int lc87 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc87);
  const int lc88 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc88) {
    
    /* if arr[0] then */
    enum { lc89 = 3 };
    lua_pushnumber(L,0);
    lua_gettable(L,1);
    const int lc90 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc90) {
      
      /* return #arr + 1 */
      lua_len(L,1);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      return 1;
      assert(lua_gettop(L) == 3);
    }
    lua_settop(L,lc89);
    assert(lua_gettop(L) == 3);
    
    /* return #arr */
    lua_len(L,1);
    return 1;
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* else
     * return proto_get(self, arr_proto, key) */
    const int lc93 = lua_gettop(L);
    lua_getglobal(L,"proto_get");
    lua_getglobal(L,"self");
    lc_getupvalue(L,lc85,1,3);
    lua_pushvalue(L,2);
    lua_call(L,3,LUA_MULTRET);
    return (lua_gettop(L) - lc93);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc86);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* __sub metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_sub(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) - lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__sub")||luaL_getmetafield(L,idxb,"__sub")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* function (arg) */
static int lcf101 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc95 = 2 };
  assert((lua_gettop(L) == lc95));
  
  /* local str = '' */
  lua_pushliteral(L,"");
  assert(lua_gettop(L) == 3);
  
  /* for i=0,arg.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc96_var = lua_tonumber(L,-2);
  const double lc97_limit = lua_tonumber(L,-1);
  const double lc98_step = 1;
  lua_pop(L,2);
  enum { lc99 = 3 };
  while ((((lc98_step > 0) && (lc96_var <= lc97_limit)) || ((lc98_step <= 0) && (lc96_var >= lc97_limit)))) {
    
    /* internal: local i at index 4 */
    lua_pushnumber(L,lc96_var);
    
    /* str = str .. tostring(arg[i]) .. (i == arg.length-1 and '' or ',') */
    lua_pushvalue(L,3);
    lua_getglobal(L,"tostring");
    lua_pushvalue(L,4);
    lua_gettable(L,1);
    lua_call(L,1,1);
    lua_pushvalue(L,4);
    lua_pushliteral(L,"length");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    const int lc100 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc100);
    if (lua_toboolean(L,-1)) {
      lua_pop(L,1);
      lua_pushliteral(L,"");
    }
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushliteral(L,",");
    }
    lua_concat(L,2);
    lua_concat(L,2);
    lua_replace(L,3);
    assert(lua_gettop(L) == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc96_var += lc98_step;
  }
  lua_settop(L,lc99);
  assert(lua_gettop(L) == 3);
  
  /* return str */
  lua_pushvalue(L,3);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* function (arg) */
static int lcf108 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc102 = 2 };
  assert((lua_gettop(L) == lc102));
  
  /* local arr = {} */
  lua_newtable(L);
  assert(lua_gettop(L) == 3);
  
  /* for i=0,arg.length do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc103_var = lua_tonumber(L,-2);
  const double lc104_limit = lua_tonumber(L,-1);
  const double lc105_step = 1;
  lua_pop(L,2);
  enum { lc106 = 3 };
  while ((((lc105_step > 0) && (lc103_var <= lc104_limit)) || ((lc105_step <= 0) && (lc103_var >= lc104_limit)))) {
    
    /* internal: local i at index 4 */
    lua_pushnumber(L,lc103_var);
    
    /* table.insert(arr, arg[i]) */
    lua_getglobal(L,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,3);
    lua_pushvalue(L,4);
    lua_gettable(L,1);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc103_var += lc105_step;
  }
  lua_settop(L,lc106);
  assert(lua_gettop(L) == 3);
  
  /* return dkjson.encode(arr, {indent = true}) */
  const int lc107 = lua_gettop(L);
  lua_getglobal(L,"dkjson");
  lua_pushliteral(L,"encode");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,3);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"indent");
  lua_pushboolean(L,1);
  lua_rawset(L,-3);
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc107);
  assert(lua_gettop(L) == 3);
}


/* name: global._arr
 * function (a) */
static int lcf1_global__arr (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc109 = 2 };
  assert((lua_gettop(L) == lc109));
  
  /* setmetatable(a, arr_mt) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc109,1,11);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 2);
  
  /* return a */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 2);
}


/* name: global._void
 * function () */
static int lcf1_global__void (lua_State * L) {
  enum { lc_nformalargs = 0 };
  lua_settop(L,0);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc110 = 1 };
  assert((lua_gettop(L) == lc110));
  return 0;
}


/* name: global._typeof
 * function (arg) */
static int lcf1_global__typeof (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc111 = 2 };
  assert((lua_gettop(L) == lc111));
  
  /* if arg == nil then */
  enum { lc112 = 2 };
  lua_pushnil(L);
  const int lc113 = lua_compare(L,1,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc113);
  const int lc114 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc114) {
    
    /* return 'undefined' */
    lua_pushliteral(L,"undefined");
    return 1;
    assert(lua_gettop(L) == 2);
  }
  else {
    
    /* elseif type(arg) == 'table' then */
    enum { lc115 = 2 };
    lua_getglobal(L,"type");
    lua_pushvalue(L,1);
    lua_call(L,1,1);
    lua_pushliteral(L,"table");
    const int lc116 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc116);
    const int lc117 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc117) {
      
      /* return 'object' */
      lua_pushliteral(L,"object");
      return 1;
      assert(lua_gettop(L) == 2);
    }
    lua_settop(L,lc115);
  }
  lua_settop(L,lc112);
  assert(lua_gettop(L) == 2);
  
  /* return type(arg) */
  const int lc118 = lua_gettop(L);
  lua_getglobal(L,"type");
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc118);
  assert(lua_gettop(L) == 2);
}


/* name: global._instanceof
 * function (self, arg) */
static int lcf1_global__instanceof (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc119 = 3 };
  assert((lua_gettop(L) == lc119));
  
  /* return getmetatable(self).__index == arg.prototype */
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_pushliteral(L,"__index");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"prototype");
  lua_gettable(L,2);
  const int lc120 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc120);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* function (self, key) */
static int lcf124 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc122 = 3 };
  assert((lua_gettop(L) == lc122));
  
  /* return proto_get(self, f.prototype, key) */
  const int lc123 = lua_gettop(L);
  lua_getglobal(L,"proto_get");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc122,1,12);
  lua_pushliteral(L,"prototype");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc123);
  assert(lua_gettop(L) == 3);
}


/* name: global._new
 * function (f, ...) */
static int lcf1_global__new (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc121 = 2 };
  assert((lua_gettop(L) == (lc121 + lc_nextra)));
  lua_pushvalue(L,1);
  lua_rawseti(L,-2,12);
  
  /* local o = {} */
  lua_newtable(L);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* setmetatable(o, {
   *     __index = function (self, key)
   *       return proto_get(self, f.prototype, key)
   *     end,
   *     __proto = f.prototype
   *   }) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,(3 + lc_nextra));
  lua_createtable(L,0,2);
  lua_pushliteral(L,"__index");
  lua_pushvalue(L,(lc121 + lc_nextra));
  lua_pushcclosure(L,lcf124,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"__proto");
  lc_getupvalue(L,(lc121 + lc_nextra),0,12);
  lua_pushliteral(L,"prototype");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* local r = f(o, ...) */
  lc_getupvalue(L,(lc121 + lc_nextra),0,12);
  const int lc125 = lua_gettop(L);
  lua_pushvalue(L,(3 + lc_nextra));
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc125),1);
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* if r then */
  enum { lc126 = 4 };
  if (lua_toboolean(L,(4 + lc_nextra))) {
    
    /* return r */
    lua_pushvalue(L,(4 + lc_nextra));
    return 1;
    assert(lua_gettop(L) - lc_nextra == 4);
  }
  lua_settop(L,(lc126 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* return o */
  lua_pushvalue(L,(3 + lc_nextra));
  return 1;
  assert(lua_gettop(L) - lc_nextra == 4);
}


/* name: num_proto.toFixed
 * function (num, n) */
static int lcf1_num_proto_toFixed (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc127 = 3 };
  assert((lua_gettop(L) == lc127));
  
  /* return string.format("%." .. tonumber(n) .. "f", num) */
  const int lc128 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"format");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"%.");
  lua_getglobal(L,"tonumber");
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_pushliteral(L,"f");
  lua_concat(L,2);
  lua_concat(L,2);
  lua_pushvalue(L,1);
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc128);
  assert(lua_gettop(L) == 3);
}


/* name: num_proto.toString
 * function (num, n) */
static int lcf1_num_proto_toString (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc129 = 3 };
  assert((lua_gettop(L) == lc129));
  
  /* if n == 16 then */
  enum { lc130 = 3 };
  lua_pushnumber(L,16);
  const int lc131 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc131);
  const int lc132 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc132) {
    
    /* return string.format("%x", num) */
    const int lc133 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"format");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"%x");
    lua_pushvalue(L,1);
    lua_call(L,2,LUA_MULTRET);
    return (lua_gettop(L) - lc133);
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* else
     * return tostring(num) */
    const int lc134 = lua_gettop(L);
    lua_getglobal(L,"tostring");
    lua_pushvalue(L,1);
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc134);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc130);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: str_proto.charCodeAt
 * function (str, i, a) */
static int lcf1_str_proto_charCodeAt (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc135 = 4 };
  assert((lua_gettop(L) == lc135));
  
  /* return string.byte(str, i+1) */
  const int lc136 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"byte");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushnumber(L,1);
  lc_add(L,2,-1);
  lua_remove(L,-2);
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc136);
  assert(lua_gettop(L) == 4);
}


/* name: str_proto.charAt
 * function (str, i) */
static int lcf1_str_proto_charAt (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc137 = 3 };
  assert((lua_gettop(L) == lc137));
  
  /* return string.sub(str, i+1, i+1) */
  const int lc138 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"sub");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushnumber(L,1);
  lc_add(L,2,-1);
  lua_remove(L,-2);
  lua_pushnumber(L,1);
  lc_add(L,2,-1);
  lua_remove(L,-2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc138);
  assert(lua_gettop(L) == 3);
}


/* name: str_proto.substr
 * function (str, i, len) */
static int lcf1_str_proto_substr (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc139 = 4 };
  assert((lua_gettop(L) == lc139));
  
  /* if i < 0 then */
  enum { lc140 = 4 };
  lua_pushnumber(L,0);
  const int lc141 = lua_compare(L,2,-1,LUA_OPLT);
  lua_pop(L,1);
  lua_pushboolean(L,lc141);
  const int lc142 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc142) {
    
    /* i = i - 1 */
    lua_pushnumber(L,1);
    lc_sub(L,2,-1);
    lua_remove(L,-2);
    lua_replace(L,2);
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc140);
  assert(lua_gettop(L) == 4);
  
  /* if len ~= nil then */
  enum { lc143 = 4 };
  lua_pushnil(L);
  const int lc144 = lua_compare(L,3,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc144);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  const int lc145 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc145) {
    
    /* return string.sub(str, i+1, i + len) */
    const int lc146 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"sub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushnumber(L,1);
    lc_add(L,2,-1);
    lua_remove(L,-2);
    lc_add(L,2,3);
    lua_call(L,3,LUA_MULTRET);
    return (lua_gettop(L) - lc146);
    assert(lua_gettop(L) == 4);
  }
  else {
    
    /* else
     * return string.sub(str, i+1) */
    const int lc147 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"sub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushnumber(L,1);
    lc_add(L,2,-1);
    lua_remove(L,-2);
    lua_call(L,2,LUA_MULTRET);
    return (lua_gettop(L) - lc147);
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc143);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: str_proto.slice
 * function (str, i, len) */
static int lcf1_str_proto_slice (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc148 = 4 };
  assert((lua_gettop(L) == lc148));
  
  /* return string.sub(str, i+1, len or -1) */
  const int lc149 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"sub");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushnumber(L,1);
  lc_add(L,2,-1);
  lua_remove(L,-2);
  lua_pushvalue(L,3);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,-1);
  }
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc149);
  assert(lua_gettop(L) == 4);
}


/* name: str_proto.toLowerCase
 * function (str) */
static int lcf1_str_proto_toLowerCase (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc150 = 2 };
  assert((lua_gettop(L) == lc150));
  
  /* return string.lower(str) */
  const int lc151 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"lower");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc151);
  assert(lua_gettop(L) == 2);
}


/* name: str_proto.toUpperCase
 * function (str) */
static int lcf1_str_proto_toUpperCase (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc152 = 2 };
  assert((lua_gettop(L) == lc152));
  
  /* return string.upper(str) */
  const int lc153 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"upper");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc153);
  assert(lua_gettop(L) == 2);
}


/* name: str_proto.indexOf
 * function (str, needle) */
static int lcf1_str_proto_indexOf (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc154 = 3 };
  assert((lua_gettop(L) == lc154));
  
  /* local ret = string.find(str, tostring(needle), 1, true) */
  lua_getglobal(L,"string");
  lua_pushliteral(L,"find");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_getglobal(L,"tostring");
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_pushnumber(L,1);
  lua_pushboolean(L,1);
  lua_call(L,4,1);
  assert(lua_gettop(L) == 4);
  
  /* if ret == null then */
  enum { lc155 = 4 };
  lua_getglobal(L,"null");
  const int lc156 = lua_compare(L,4,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc156);
  const int lc157 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc157) {
    
    /* return -1 */
    lua_pushnumber(L,-1);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  else {
    
    /* else
     * return ret - 1 */
    lua_pushnumber(L,1);
    lc_sub(L,4,-1);
    lua_remove(L,-2);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc155);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: str_proto.split
 * function (str, sep, max) */
static int lcf1_str_proto_split (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc158 = 4 };
  assert((lua_gettop(L) == lc158));
  
  /* if sep == '' then */
  enum { lc159 = 4 };
  lua_pushliteral(L,"");
  const int lc160 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc160);
  const int lc161 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc161) {
    
    /* local ret = global._arr({}) */
    lc_getupvalue(L,lc158,3,2);
    lua_pushliteral(L,"_arr");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_newtable(L);
    lua_call(L,1,1);
    assert(lua_gettop(L) == 5);
    
    /* for i=0,str.length-1 do */
    lua_pushnumber(L,0);
    lua_pushliteral(L,"length");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
      luaL_error(L,"'for' limit must be a number");
    }
    double lc162_var = lua_tonumber(L,-2);
    const double lc163_limit = lua_tonumber(L,-1);
    const double lc164_step = 1;
    lua_pop(L,2);
    enum { lc165 = 5 };
    while ((((lc164_step > 0) && (lc162_var <= lc163_limit)) || ((lc164_step <= 0) && (lc162_var >= lc163_limit)))) {
      
      /* internal: local i at index 6 */
      lua_pushnumber(L,lc162_var);
      
      /* ret:push(str:charAt(i)) */
      lua_pushvalue(L,5);
      const int lc166 = lua_gettop(L);
      lua_pushliteral(L,"push");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_pushvalue(L,1);
      lua_pushliteral(L,"charAt");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_pushvalue(L,6);
      lua_call(L,2,LUA_MULTRET);
      lua_call(L,(lua_gettop(L) - lc166),0);
      assert(lua_gettop(L) == 6);
      
      /* internal: stack cleanup on scope exit */
      lua_pop(L,1);
      lc162_var += lc164_step;
    }
    lua_settop(L,lc165);
    assert(lua_gettop(L) == 5);
    
    /* return ret */
    lua_pushvalue(L,5);
    return 1;
    assert(lua_gettop(L) == 5);
  }
  lua_settop(L,lc159);
  assert(lua_gettop(L) == 4);
  
  /* local ret = {} */
  lua_newtable(L);
  assert(lua_gettop(L) == 5);
  
  /* if string.len(str) > 0 then */
  enum { lc167 = 5 };
  lua_pushnumber(L,0);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"len");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  const int lc168 = lua_compare(L,-2,-1,LUA_OPLT);
  lua_pop(L,2);
  lua_pushboolean(L,lc168);
  const int lc169 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc169) {
    
    /* max = max or -1 */
    lua_pushvalue(L,3);
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,-1);
    }
    lua_replace(L,3);
    assert(lua_gettop(L) == 5);
    
    /* local i, start=1, 1 */
    lua_pushnumber(L,1);
    lua_pushnumber(L,1);
    assert(lua_gettop(L) == 7);
    
    /* local first, last = string.find(str, sep, start, true) */
    lua_getglobal(L,"string");
    lua_pushliteral(L,"find");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,2);
    lua_pushvalue(L,7);
    lua_pushboolean(L,1);
    lua_call(L,4,2);
    assert(lua_gettop(L) == 9);
    
    /* while first and max ~= 0 do */
    enum { lc170 = 9 };
    while (1) {
      lua_pushvalue(L,8);
      if (lua_toboolean(L,-1)) {
        lua_pop(L,1);
        lua_pushnumber(L,0);
        const int lc171 = lua_compare(L,3,-1,LUA_OPEQ);
        lua_pop(L,1);
        lua_pushboolean(L,lc171);
        lua_pushboolean(L,!(lua_toboolean(L,-1)));
        lua_remove(L,-2);
      }
      if (!(lua_toboolean(L,-1))) {
        break;
      }
      lua_pop(L,1);
      
      /* ret[i-1] = string.sub(str, start, first-1) */
      lua_getglobal(L,"string");
      lua_pushliteral(L,"sub");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_pushvalue(L,7);
      lua_pushnumber(L,1);
      lc_sub(L,8,-1);
      lua_remove(L,-2);
      lua_call(L,3,1);
      lua_pushnumber(L,1);
      lc_sub(L,6,-1);
      lua_remove(L,-2);
      lua_insert(L,-2);
      lua_settable(L,5);
      assert(lua_gettop(L) == 9);
      
      /* i, start = i+1, last+1 */
      lua_pushnumber(L,1);
      lc_add(L,6,-1);
      lua_remove(L,-2);
      lua_pushnumber(L,1);
      lc_add(L,9,-1);
      lua_remove(L,-2);
      lua_replace(L,7);
      lua_replace(L,6);
      assert(lua_gettop(L) == 9);
      
      /* first, last = string.find(str, sep, start, true) */
      lua_getglobal(L,"string");
      lua_pushliteral(L,"find");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_pushvalue(L,2);
      lua_pushvalue(L,7);
      lua_pushboolean(L,1);
      lua_call(L,4,2);
      lua_replace(L,9);
      lua_replace(L,8);
      assert(lua_gettop(L) == 9);
      
      /* max = max-1 */
      lua_pushnumber(L,1);
      lc_sub(L,3,-1);
      lua_remove(L,-2);
      lua_replace(L,3);
      assert(lua_gettop(L) == 9);
    }
    lua_settop(L,lc170);
    assert(lua_gettop(L) == 9);
    
    /* ret[i-1] = string.sub(str, start) */
    lua_getglobal(L,"string");
    lua_pushliteral(L,"sub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,7);
    lua_call(L,2,1);
    lua_pushnumber(L,1);
    lc_sub(L,6,-1);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,5);
    assert(lua_gettop(L) == 9);
  }
  lua_settop(L,lc167);
  assert(lua_gettop(L) == 5);
  
  /* return global._arr(ret) */
  const int lc172 = lua_gettop(L);
  lc_getupvalue(L,lc158,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,5);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc172);
  assert(lua_gettop(L) == 5);
}


/* name: str_proto.replace
 * function (str, match, out) */
static int lcf1_str_proto_replace (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc173 = 4 };
  assert((lua_gettop(L) == lc173));
  
  /* if type(match) == 'string' then */
  enum { lc174 = 4 };
  lua_getglobal(L,"type");
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_pushliteral(L,"string");
  const int lc175 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc175);
  const int lc176 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc176) {
    
    /* return string.gsub(str, string.gsub(match, "(%W)","%%%1"), out) */
    const int lc177 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"gsub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"gsub");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,2);
    lua_pushliteral(L,"(%W)");
    lua_pushliteral(L,"%%%1");
    lua_call(L,3,1);
    lua_pushvalue(L,3);
    lua_call(L,3,LUA_MULTRET);
    return (lua_gettop(L) - lc177);
    assert(lua_gettop(L) == 4);
  }
  else {
    
    /* elseif global._instanceof(match, global.RegExp) then */
    enum { lc178 = 4 };
    lc_getupvalue(L,lc173,3,2);
    lua_pushliteral(L,"_instanceof");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,2);
    lc_getupvalue(L,lc173,3,2);
    lua_pushliteral(L,"RegExp");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_call(L,2,1);
    const int lc179 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc179) {
      
      /* if type(out) == 'function' then */
      enum { lc180 = 4 };
      lua_getglobal(L,"type");
      lua_pushvalue(L,3);
      lua_call(L,1,1);
      lua_pushliteral(L,"function");
      const int lc181 = lua_compare(L,-2,-1,LUA_OPEQ);
      lua_pop(L,2);
      lua_pushboolean(L,lc181);
      const int lc182 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc182) {
        
        /* print('REGEX REPLACE NOT SUPPORTED') */
        lua_getglobal(L,"print");
        lua_pushliteral(L,"REGEX REPLACE NOT SUPPORTED");
        lua_call(L,1,0);
        assert(lua_gettop(L) == 4);
      }
      lua_settop(L,lc180);
      assert(lua_gettop(L) == 4);
      
      /* local count = 1 */
      lua_pushnumber(L,1);
      assert(lua_gettop(L) == 5);
      
      /* if string.find(match.flags, 'g') ~= nil then */
      enum { lc183 = 5 };
      lua_getglobal(L,"string");
      lua_pushliteral(L,"find");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushliteral(L,"flags");
      lua_gettable(L,2);
      lua_pushliteral(L,"g");
      lua_call(L,2,1);
      lua_pushnil(L);
      const int lc184 = lua_compare(L,-2,-1,LUA_OPEQ);
      lua_pop(L,2);
      lua_pushboolean(L,lc184);
      lua_pushboolean(L,!(lua_toboolean(L,-1)));
      lua_remove(L,-2);
      const int lc185 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc185) {
        
        /* count = nil */
        lua_pushnil(L);
        lua_replace(L,5);
        assert(lua_gettop(L) == 5);
      }
      lua_settop(L,lc183);
      assert(lua_gettop(L) == 5);
      
      /* return rex.gsub(str, match.pattern, out, count) */
      const int lc186 = lua_gettop(L);
      lc_getupvalue(L,lc173,4,1);
      lua_pushliteral(L,"gsub");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,1);
      lua_pushliteral(L,"pattern");
      lua_gettable(L,2);
      lua_pushvalue(L,3);
      lua_pushvalue(L,5);
      lua_call(L,4,LUA_MULTRET);
      return (lua_gettop(L) - lc186);
      assert(lua_gettop(L) == 5);
    }
    else {
      
      /* else
       * error('Unknown regex invocation object: ' .. type(match)) */
      lua_getglobal(L,"error");
      lua_pushliteral(L,"Unknown regex invocation object: ");
      lua_getglobal(L,"type");
      lua_pushvalue(L,2);
      lua_call(L,1,1);
      lua_concat(L,2);
      lua_call(L,1,0);
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc178);
  }
  lua_settop(L,lc174);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: obj_proto.hasInstance
 * function (ths, p) */
static int lcf1_obj_proto_hasInstance (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc187 = 3 };
  assert((lua_gettop(L) == lc187));
  
  /* return toboolean(rawget(ths, p)) */
  const int lc188 = lua_gettop(L);
  lua_getglobal(L,"toboolean");
  const int lc189 = lua_gettop(L);
  lua_getglobal(L,"rawget");
  lua_pushvalue(L,1);
  lua_pushvalue(L,2);
  lua_call(L,2,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc189),LUA_MULTRET);
  return (lua_gettop(L) - lc188);
  assert(lua_gettop(L) == 3);
}


/* name: obj_proto.hasOwnProperty
 * function (ths, p) */
static int lcf1_obj_proto_hasOwnProperty (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc190 = 3 };
  assert((lua_gettop(L) == lc190));
  
  /* return rawget(ths, p) ~= nil */
  lua_getglobal(L,"rawget");
  lua_pushvalue(L,1);
  lua_pushvalue(L,2);
  lua_call(L,2,1);
  lua_pushnil(L);
  const int lc191 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc191);
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: getmetatable(self).__index
 * function (self, getkey) */
static int lcf1_getmetatable_self____index (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc194 = 3 };
  assert((lua_gettop(L) == lc194));
  
  /* if key == getkey then */
  enum { lc195 = 3 };
  lc_getupvalue(L,lc194,2,13);
  const int lc196 = lua_compare(L,-1,2,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc196);
  const int lc197 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc197) {
    
    /* return fn(self) */
    const int lc198 = lua_gettop(L);
    lc_getupvalue(L,lc194,2,14);
    lua_pushvalue(L,1);
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc198);
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* else
     * if type(idx) == 'function' then */
    enum { lc199 = 3 };
    lua_getglobal(L,"type");
    lc_getupvalue(L,lc194,1,15);
    lua_call(L,1,1);
    lua_pushliteral(L,"function");
    const int lc200 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc200);
    const int lc201 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc201) {
      
      /* return idx(self, getkey) */
      const int lc202 = lua_gettop(L);
      lc_getupvalue(L,lc194,1,15);
      lua_pushvalue(L,1);
      lua_pushvalue(L,2);
      lua_call(L,2,LUA_MULTRET);
      return (lua_gettop(L) - lc202);
      assert(lua_gettop(L) == 3);
    }
    else {
      
      /* else
       * return idx[getkey] */
      lc_getupvalue(L,lc194,1,15);
      lua_pushvalue(L,2);
      lua_gettable(L,-2);
      lua_remove(L,-2);
      return 1;
      assert(lua_gettop(L) == 3);
    }
    lua_settop(L,lc199);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc195);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: obj_proto.__defineGetter__
 * function (self, key, fn) */
static int lcf1_obj_proto___defineGetter__ (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc192 = 4 };
  assert((lua_gettop(L) == lc192));
  lua_pushvalue(L,2);
  lua_rawseti(L,-2,13);
  lua_pushvalue(L,3);
  lua_rawseti(L,-2,14);
  
  /* local idx = getmetatable(self).__index */
  lc_newclosuretable(L,lc192);
  enum { lc193 = 5 };
  assert((lua_gettop(L) == lc193));
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_pushliteral(L,"__index");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawseti(L,lc193,15);
  assert(lua_gettop(L) == 5);
  
  /* getmetatable(self).__index = function (self, getkey)
   *     if key == getkey then
   *       return fn(self)
   *     else
   *       if type(idx) == 'function' then
   *         return idx(self, getkey)
   *       else
   *         return idx[getkey]
   *       end
   *     end
   *   end */
  lua_pushvalue(L,lc193);
  lua_pushcclosure(L,lcf1_getmetatable_self____index,1);
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_insert(L,-2);
  lua_pushliteral(L,"__index");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 5);
  return 0;
}


/* name: func_proto.call
 * function (func, ths, ...) */
static int lcf1_func_proto_call (lua_State * L) {
  enum { lc_nformalargs = 2 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc203 = 3 };
  assert((lua_gettop(L) == (lc203 + lc_nextra)));
  
  /* return func(ths, ...) */
  const int lc204 = lua_gettop(L);
  lua_pushvalue(L,1);
  const int lc205 = lua_gettop(L);
  lua_pushvalue(L,2);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc205),LUA_MULTRET);
  return (lua_gettop(L) - lc204);
  assert(lua_gettop(L) - lc_nextra == 3);
}


/* name: func_proto.apply
 * function (func, ths, args) */
static int lcf1_func_proto_apply (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc206 = 4 };
  assert((lua_gettop(L) == lc206));
  
  /* -- copy args to new args array
   * local luargs = {} */
  lua_newtable(L);
  assert(lua_gettop(L) == 5);
  
  /* for i=0,args.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,3);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc207_var = lua_tonumber(L,-2);
  const double lc208_limit = lua_tonumber(L,-1);
  const double lc209_step = 1;
  lua_pop(L,2);
  enum { lc210 = 5 };
  while ((((lc209_step > 0) && (lc207_var <= lc208_limit)) || ((lc209_step <= 0) && (lc207_var >= lc208_limit)))) {
    
    /* internal: local i at index 6 */
    lua_pushnumber(L,lc207_var);
    
    /* luargs[i+1] = args[i] */
    lua_pushvalue(L,6);
    lua_gettable(L,3);
    lua_pushnumber(L,1);
    lc_add(L,6,-1);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,5);
    assert(lua_gettop(L) == 6);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc207_var += lc209_step;
  }
  lua_settop(L,lc210);
  assert(lua_gettop(L) == 5);
  
  /* return func(ths, unpack(luargs)) */
  const int lc211 = lua_gettop(L);
  lua_pushvalue(L,1);
  const int lc212 = lua_gettop(L);
  lua_pushvalue(L,2);
  lua_getglobal(L,"unpack");
  lua_pushvalue(L,5);
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc212),LUA_MULTRET);
  return (lua_gettop(L) - lc211);
  assert(lua_gettop(L) == 5);
}


/* name: arr_proto.push
 * function (ths, elem) */
static int lcf1_arr_proto_push (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc213 = 3 };
  assert((lua_gettop(L) == lc213));
  
  /* if ths.length == 0 then */
  enum { lc214 = 3 };
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,0);
  const int lc215 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc215);
  const int lc216 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc216) {
    
    /* ths[0] = elem */
    lua_pushvalue(L,2);
    lua_pushnumber(L,0);
    lua_insert(L,-2);
    lua_settable(L,1);
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* else
     * table.insert(ths, ths.length, elem) */
    lua_getglobal(L,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"length");
    lua_gettable(L,1);
    lua_pushvalue(L,2);
    lua_call(L,3,0);
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc214);
  assert(lua_gettop(L) == 3);
  
  /* return ths.length */
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: arr_proto.pop
 * function (ths) */
static int lcf1_arr_proto_pop (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc217 = 2 };
  assert((lua_gettop(L) == lc217));
  
  /* if ths.length == 1 then */
  enum { lc218 = 2 };
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  const int lc219 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc219);
  const int lc220 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc220) {
    
    /* local _val = ths[0] */
    lua_pushnumber(L,0);
    lua_gettable(L,1);
    assert(lua_gettop(L) == 3);
    
    /* ths[0] = nil */
    lua_pushnil(L);
    lua_pushnumber(L,0);
    lua_insert(L,-2);
    lua_settable(L,1);
    assert(lua_gettop(L) == 3);
    
    /* return _val */
    lua_pushvalue(L,3);
    return 1;
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc218);
  assert(lua_gettop(L) == 2);
  
  /* return table.remove(ths, ths.length-1) */
  const int lc221 = lua_gettop(L);
  lua_getglobal(L,"table");
  lua_pushliteral(L,"remove");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,2,LUA_MULTRET);
  return (lua_gettop(L) - lc221);
  assert(lua_gettop(L) == 2);
}


/* name: arr_proto.shift
 * function (ths) */
static int lcf1_arr_proto_shift (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc222 = 2 };
  assert((lua_gettop(L) == lc222));
  
  /* local ret = ths[0] */
  lua_pushnumber(L,0);
  lua_gettable(L,1);
  assert(lua_gettop(L) == 3);
  
  /* ths[0] = table.remove(ths, 1) */
  lua_getglobal(L,"table");
  lua_pushliteral(L,"remove");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,1);
  lua_pushnumber(L,1);
  lua_call(L,2,1);
  lua_pushnumber(L,0);
  lua_insert(L,-2);
  lua_settable(L,1);
  assert(lua_gettop(L) == 3);
  
  /* return ret */
  lua_pushvalue(L,3);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: arr_proto.unshift
 * function (ths, elem) */
static int lcf1_arr_proto_unshift (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc223 = 3 };
  assert((lua_gettop(L) == lc223));
  
  /* local _val = nil */
  lua_pushnil(L);
  assert(lua_gettop(L) == 4);
  
  /* if ths.length > 0 then */
  enum { lc224 = 4 };
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  const int lc225 = lua_compare(L,-2,-1,LUA_OPLT);
  lua_pop(L,2);
  lua_pushboolean(L,lc225);
  const int lc226 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc226) {
    
    /* _val = table.insert(ths, 1, elem[0]) */
    lua_getglobal(L,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushnumber(L,1);
    lua_pushnumber(L,0);
    lua_gettable(L,2);
    lua_call(L,3,1);
    lua_replace(L,4);
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc224);
  assert(lua_gettop(L) == 4);
  
  /* ths[0] = elem */
  lua_pushvalue(L,2);
  lua_pushnumber(L,0);
  lua_insert(L,-2);
  lua_settable(L,1);
  assert(lua_gettop(L) == 4);
  
  /* return _val */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: arr_proto.reverse
 * function (ths) */
static int lcf1_arr_proto_reverse (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc227 = 2 };
  assert((lua_gettop(L) == lc227));
  
  /* local arr = global._arr({}) */
  lc_getupvalue(L,lc227,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 3);
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc228_var = lua_tonumber(L,-2);
  const double lc229_limit = lua_tonumber(L,-1);
  const double lc230_step = 1;
  lua_pop(L,2);
  enum { lc231 = 3 };
  while ((((lc230_step > 0) && (lc228_var <= lc229_limit)) || ((lc230_step <= 0) && (lc228_var >= lc229_limit)))) {
    
    /* internal: local i at index 4 */
    lua_pushnumber(L,lc228_var);
    
    /* arr[ths.length - 1 - i] = ths[i] */
    lua_pushvalue(L,4);
    lua_gettable(L,1);
    lua_pushliteral(L,"length");
    lua_gettable(L,1);
    lua_pushnumber(L,1);
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lc_sub(L,-1,4);
    lua_remove(L,-2);
    lua_insert(L,-2);
    lua_settable(L,3);
    assert(lua_gettop(L) == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc228_var += lc230_step;
  }
  lua_settop(L,lc231);
  assert(lua_gettop(L) == 3);
  
  /* return arr */
  lua_pushvalue(L,3);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: arr_proto.slice
 * function (ths, start, len) */
static int lcf1_arr_proto_slice (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc232 = 4 };
  assert((lua_gettop(L) == lc232));
  
  /* local a = global._arr({}) */
  lc_getupvalue(L,lc232,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 5);
  
  /* if not len then */
  enum { lc233 = 5 };
  lua_pushboolean(L,!(lua_toboolean(L,3)));
  const int lc234 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc234) {
    
    /* len = ths.length - (start or 0) */
    lua_pushliteral(L,"length");
    lua_gettable(L,1);
    lua_pushvalue(L,2);
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushnumber(L,0);
    }
    lc_sub(L,-2,-1);
    lua_remove(L,-2);
    lua_remove(L,-2);
    lua_replace(L,3);
    assert(lua_gettop(L) == 5);
  }
  lua_settop(L,lc233);
  assert(lua_gettop(L) == 5);
  
  /* for i=start or 0,len do */
  lua_pushvalue(L,2);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
  }
  if (!((lua_isnumber(L,-1) && lua_isnumber(L,3)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc235_var = lua_tonumber(L,-1);
  const double lc236_limit = lua_tonumber(L,3);
  const double lc237_step = 1;
  lua_pop(L,1);
  enum { lc238 = 5 };
  while ((((lc237_step > 0) && (lc235_var <= lc236_limit)) || ((lc237_step <= 0) && (lc235_var >= lc236_limit)))) {
    
    /* internal: local i at index 6 */
    lua_pushnumber(L,lc235_var);
    
    /* a:push(ths[i]) */
    lua_pushvalue(L,5);
    lua_pushliteral(L,"push");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,6);
    lua_gettable(L,1);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 6);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc235_var += lc237_step;
  }
  lua_settop(L,lc238);
  assert(lua_gettop(L) == 5);
  
  /* return a */
  lua_pushvalue(L,5);
  return 1;
  assert(lua_gettop(L) == 5);
}


/* name: arr_proto.concat
 * function (src1, src2) */
static int lcf1_arr_proto_concat (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc239 = 3 };
  assert((lua_gettop(L) == lc239));
  
  /* local a = global._arr({}) */
  lc_getupvalue(L,lc239,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* for i=0,src1.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc240_var = lua_tonumber(L,-2);
  const double lc241_limit = lua_tonumber(L,-1);
  const double lc242_step = 1;
  lua_pop(L,2);
  enum { lc243 = 4 };
  while ((((lc242_step > 0) && (lc240_var <= lc241_limit)) || ((lc242_step <= 0) && (lc240_var >= lc241_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc240_var);
    
    /* a:push(src1[i]) */
    lua_pushvalue(L,4);
    lua_pushliteral(L,"push");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,5);
    lua_gettable(L,1);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc240_var += lc242_step;
  }
  lua_settop(L,lc243);
  assert(lua_gettop(L) == 4);
  
  /* for i=0,src2.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,2);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc244_var = lua_tonumber(L,-2);
  const double lc245_limit = lua_tonumber(L,-1);
  const double lc246_step = 1;
  lua_pop(L,2);
  enum { lc247 = 4 };
  while ((((lc246_step > 0) && (lc244_var <= lc245_limit)) || ((lc246_step <= 0) && (lc244_var >= lc245_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc244_var);
    
    /* a:push(src2[i]) */
    lua_pushvalue(L,4);
    lua_pushliteral(L,"push");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,5);
    lua_gettable(L,2);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc244_var += lc246_step;
  }
  lua_settop(L,lc247);
  assert(lua_gettop(L) == 4);
  
  /* return a */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: arr_proto.join
 * function (ths, str) */
static int lcf1_arr_proto_join (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc248 = 3 };
  assert((lua_gettop(L) == lc248));
  
  /* local _r = "" */
  lua_pushliteral(L,"");
  assert(lua_gettop(L) == 4);
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc249_var = lua_tonumber(L,-2);
  const double lc250_limit = lua_tonumber(L,-1);
  const double lc251_step = 1;
  lua_pop(L,2);
  enum { lc252 = 4 };
  while ((((lc251_step > 0) && (lc249_var <= lc250_limit)) || ((lc251_step <= 0) && (lc249_var >= lc250_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc249_var);
    
    /* if not ths[i] or ths[i] == _null then */
    enum { lc253 = 5 };
    lua_pushvalue(L,5);
    lua_gettable(L,1);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
    if (!(lua_toboolean(L,-1))) {
      lua_pop(L,1);
      lua_pushvalue(L,5);
      lua_gettable(L,1);
      lua_getglobal(L,"_null");
      const int lc254 = lua_compare(L,-2,-1,LUA_OPEQ);
      lua_pop(L,2);
      lua_pushboolean(L,lc254);
    }
    const int lc255 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc255) {
      
      /* _r = _r .. str */
      lua_pushvalue(L,4);
      lua_pushvalue(L,2);
      lua_concat(L,2);
      lua_replace(L,4);
      assert(lua_gettop(L) == 5);
    }
    else {
      
      /* else
       * _r = _r .. ths[i] .. str */
      lua_pushvalue(L,4);
      lua_pushvalue(L,5);
      lua_gettable(L,1);
      lua_pushvalue(L,2);
      lua_concat(L,2);
      lua_concat(L,2);
      lua_replace(L,4);
      assert(lua_gettop(L) == 5);
    }
    lua_settop(L,lc253);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc249_var += lc251_step;
  }
  lua_settop(L,lc252);
  assert(lua_gettop(L) == 4);
  
  /* return string.sub(_r, 1, string.len(_r) - string.len(str)) */
  const int lc256 = lua_gettop(L);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"sub");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,4);
  lua_pushnumber(L,1);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"len");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,4);
  lua_call(L,1,1);
  lua_getglobal(L,"string");
  lua_pushliteral(L,"len");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc256);
  assert(lua_gettop(L) == 4);
}


/* name: arr_proto.indexOf
 * function (ths, val) */
static int lcf1_arr_proto_indexOf (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc257 = 3 };
  assert((lua_gettop(L) == lc257));
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc258_var = lua_tonumber(L,-2);
  const double lc259_limit = lua_tonumber(L,-1);
  const double lc260_step = 1;
  lua_pop(L,2);
  enum { lc261 = 3 };
  while ((((lc260_step > 0) && (lc258_var <= lc259_limit)) || ((lc260_step <= 0) && (lc258_var >= lc259_limit)))) {
    
    /* internal: local i at index 4 */
    lua_pushnumber(L,lc258_var);
    
    /* if ths[i] == val then */
    enum { lc262 = 4 };
    lua_pushvalue(L,4);
    lua_gettable(L,1);
    const int lc263 = lua_compare(L,-1,2,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc263);
    const int lc264 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc264) {
      
      /* return i */
      lua_pushvalue(L,4);
      return 1;
      assert(lua_gettop(L) == 4);
    }
    lua_settop(L,lc262);
    assert(lua_gettop(L) == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc258_var += lc260_step;
  }
  lua_settop(L,lc261);
  assert(lua_gettop(L) == 3);
  
  /* return -1 */
  lua_pushnumber(L,-1);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: arr_proto.map
 * function (ths, fn) */
static int lcf1_arr_proto_map (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc265 = 3 };
  assert((lua_gettop(L) == lc265));
  
  /* local a = global._arr({}) */
  lc_getupvalue(L,lc265,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc266_var = lua_tonumber(L,-2);
  const double lc267_limit = lua_tonumber(L,-1);
  const double lc268_step = 1;
  lua_pop(L,2);
  enum { lc269 = 4 };
  while ((((lc268_step > 0) && (lc266_var <= lc267_limit)) || ((lc268_step <= 0) && (lc266_var >= lc267_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc266_var);
    
    /* a:push(fn(ths, ths[i], i)) */
    lua_pushvalue(L,4);
    const int lc270 = lua_gettop(L);
    lua_pushliteral(L,"push");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,5);
    lua_gettable(L,1);
    lua_pushvalue(L,5);
    lua_call(L,3,LUA_MULTRET);
    lua_call(L,(lua_gettop(L) - lc270),0);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc266_var += lc268_step;
  }
  lua_settop(L,lc269);
  assert(lua_gettop(L) == 4);
  
  /* return a */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: arr_proto.forEach
 * function (ths, fn) */
static int lcf1_arr_proto_forEach (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc271 = 3 };
  assert((lua_gettop(L) == lc271));
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc272_var = lua_tonumber(L,-2);
  const double lc273_limit = lua_tonumber(L,-1);
  const double lc274_step = 1;
  lua_pop(L,2);
  enum { lc275 = 3 };
  while ((((lc274_step > 0) && (lc272_var <= lc273_limit)) || ((lc274_step <= 0) && (lc272_var >= lc273_limit)))) {
    
    /* internal: local i at index 4 */
    lua_pushnumber(L,lc272_var);
    
    /* fn(ths, ths[i], i) */
    lua_pushvalue(L,2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,4);
    lua_gettable(L,1);
    lua_pushvalue(L,4);
    lua_call(L,3,0);
    assert(lua_gettop(L) == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc272_var += lc274_step;
  }
  lua_settop(L,lc275);
  assert(lua_gettop(L) == 3);
  
  /* return ths */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: arr_proto.filter
 * function (ths, fn) */
static int lcf1_arr_proto_filter (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc276 = 3 };
  assert((lua_gettop(L) == lc276));
  
  /* local a = global._arr({}) */
  lc_getupvalue(L,lc276,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* for i=0,ths.length-1 do */
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,1);
  lua_pushnumber(L,1);
  lc_sub(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc277_var = lua_tonumber(L,-2);
  const double lc278_limit = lua_tonumber(L,-1);
  const double lc279_step = 1;
  lua_pop(L,2);
  enum { lc280 = 4 };
  while ((((lc279_step > 0) && (lc277_var <= lc278_limit)) || ((lc279_step <= 0) && (lc277_var >= lc278_limit)))) {
    
    /* internal: local i at index 5 */
    lua_pushnumber(L,lc277_var);
    
    /* if global._truthy(fn(ths, ths[i], i)) then */
    enum { lc281 = 5 };
    lc_getupvalue(L,lc276,3,2);
    lua_pushliteral(L,"_truthy");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    const int lc282 = lua_gettop(L);
    lua_pushvalue(L,2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,5);
    lua_gettable(L,1);
    lua_pushvalue(L,5);
    lua_call(L,3,LUA_MULTRET);
    lua_call(L,(lua_gettop(L) - lc282),1);
    const int lc283 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc283) {
      
      /* a:push(ths[i]) */
      lua_pushvalue(L,4);
      lua_pushliteral(L,"push");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_pushvalue(L,5);
      lua_gettable(L,1);
      lua_call(L,2,0);
      assert(lua_gettop(L) == 5);
    }
    lua_settop(L,lc281);
    assert(lua_gettop(L) == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,1);
    lc277_var += lc279_step;
  }
  lua_settop(L,lc280);
  assert(lua_gettop(L) == 4);
  
  /* return a */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* function (n) */
static int lcf286 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc284 = 2 };
  assert((lua_gettop(L) == lc284));
  
  /* return tonumber(n) */
  const int lc285 = lua_gettop(L);
  lua_getglobal(L,"tonumber");
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc285);
  assert(lua_gettop(L) == 2);
}


/* name: global.Object.keys
 * function (ths, obj) */
static int lcf1_global_Object_keys (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc287 = 3 };
  assert((lua_gettop(L) == lc287));
  
  /* local a = global._arr({}) */
  lc_getupvalue(L,lc287,3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* -- TODO debug this one:
   * if type(obj) == 'function' then */
  enum { lc288 = 4 };
  lua_getglobal(L,"type");
  lua_pushvalue(L,2);
  lua_call(L,1,1);
  lua_pushliteral(L,"function");
  const int lc289 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc289);
  const int lc290 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc290) {
    
    /* return a */
    lua_pushvalue(L,4);
    return 1;
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc288);
  assert(lua_gettop(L) == 4);
  
  /* for k,v in pairs(obj) do
   * internal: local f, s, var = explist */
  enum { lc291 = 4 };
  lua_getglobal(L,"pairs");
  lua_pushvalue(L,2);
  lua_call(L,1,3);
  while (1) {
    
    /* internal: local var_1, ..., var_n = f(s, var)
     *           if var_1 == nil then break end
     *           var = var_1 */
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_pushvalue(L,-3);
    lua_call(L,2,2);
    if (lua_isnil(L,-2)) {
      break;
    }
    lua_pushvalue(L,-2);
    lua_replace(L,-4);
    
    /* internal: local k with idx 8
     * internal: local v with idx 9 */
    
    
    /* a:push(k) */
    lua_pushvalue(L,4);
    lua_pushliteral(L,"push");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushvalue(L,8);
    lua_call(L,2,0);
    assert(lua_gettop(L) == 9);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
  }
  lua_settop(L,lc291);
  assert(lua_gettop(L) == 4);
  
  /* return a */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: table.pack
 * function(...) */
static int lcf1_table_pack (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc292 = 1 };
  assert((lua_gettop(L) == (lc292 + lc_nextra)));
  
  /* return { length = select("#", ...), ... } */
  lua_createtable(L,1,1);
  lua_pushliteral(L,"length");
  lua_getglobal(L,"select");
  const int lc293 = lua_gettop(L);
  lua_pushliteral(L,"#");
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc293),1);
  lua_rawset(L,-3);
  const int lc294 = lua_gettop(L);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  while ((lua_gettop(L) > lc294)) {
    lua_rawseti(L,lc294,(0 + (lua_gettop(L) - lc294)));
  }
  return 1;
  assert(lua_gettop(L) - lc_nextra == 1);
}


/* function (one, ...) */
static int lcf311 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc295 = 2 };
  assert((lua_gettop(L) == (lc295 + lc_nextra)));
  
  /* local a = table.pack(...) */
  lua_getglobal(L,"table");
  lua_pushliteral(L,"pack");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc296 = lua_gettop(L);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc296),1);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* if a.length > 0 or type(one) ~= 'number' then */
  enum { lc297 = 3 };
  lua_pushnumber(L,0);
  lua_pushliteral(L,"length");
  lua_gettable(L,(3 + lc_nextra));
  const int lc298 = lua_compare(L,-2,-1,LUA_OPLT);
  lua_pop(L,2);
  lua_pushboolean(L,lc298);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_getglobal(L,"type");
    lua_pushvalue(L,1);
    lua_call(L,1,1);
    lua_pushliteral(L,"number");
    const int lc299 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc299);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
  }
  const int lc300 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc300) {
    
    /* a[0] = one */
    lua_pushvalue(L,1);
    lua_pushnumber(L,0);
    lua_insert(L,-2);
    lua_settable(L,(3 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 3);
    
    /* return global._arr(a) */
    const int lc301 = lua_gettop(L);
    lc_getupvalue(L,(lc295 + lc_nextra),3,2);
    lua_pushliteral(L,"_arr");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,(3 + lc_nextra));
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc301);
    assert(lua_gettop(L) - lc_nextra == 3);
  }
  else {
    
    /* elseif one ~= nil then */
    enum { lc302 = 3 };
    lua_pushnil(L);
    const int lc303 = lua_compare(L,1,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc303);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
    const int lc304 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc304) {
      
      /* local a = {} */
      lua_newtable(L);
      assert(lua_gettop(L) - lc_nextra == 4);
      
      /* for i=0,tonumber(one)-1 do */
      lua_pushnumber(L,0);
      lua_getglobal(L,"tonumber");
      lua_pushvalue(L,1);
      lua_call(L,1,1);
      lua_pushnumber(L,1);
      lc_sub(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
        luaL_error(L,"'for' limit must be a number");
      }
      double lc305_var = lua_tonumber(L,-2);
      const double lc306_limit = lua_tonumber(L,-1);
      const double lc307_step = 1;
      lua_pop(L,2);
      enum { lc308 = 4 };
      while ((((lc307_step > 0) && (lc305_var <= lc306_limit)) || ((lc307_step <= 0) && (lc305_var >= lc306_limit)))) {
        
        /* internal: local i at index 5 */
        lua_pushnumber(L,lc305_var);
        
        /* a[i]=null */
        lua_getglobal(L,"null");
        lua_pushvalue(L,(5 + lc_nextra));
        lua_insert(L,-2);
        lua_settable(L,(4 + lc_nextra));
        assert(lua_gettop(L) - lc_nextra == 5);
        
        /* internal: stack cleanup on scope exit */
        lua_pop(L,1);
        lc305_var += lc307_step;
      }
      lua_settop(L,(lc308 + lc_nextra));
      assert(lua_gettop(L) - lc_nextra == 4);
      
      /* return global._arr(a) */
      const int lc309 = lua_gettop(L);
      lc_getupvalue(L,(lc295 + lc_nextra),3,2);
      lua_pushliteral(L,"_arr");
      lua_gettable(L,-2);
      lua_remove(L,-2);
      lua_pushvalue(L,(4 + lc_nextra));
      lua_call(L,1,LUA_MULTRET);
      return (lua_gettop(L) - lc309);
      assert(lua_gettop(L) - lc_nextra == 4);
    }
    lua_settop(L,(lc302 + lc_nextra));
  }
  lua_settop(L,(lc297 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* return global._arr({}) */
  const int lc310 = lua_gettop(L);
  lc_getupvalue(L,(lc295 + lc_nextra),3,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc310);
  assert(lua_gettop(L) - lc_nextra == 3);
}


/* function (a) */
static int lcf314 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc312 = 2 };
  assert((lua_gettop(L) == lc312));
  
  /* return (getmetatable(a) or {}) == arr_mt */
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_newtable(L);
  }
  lc_getupvalue(L,lc312,1,11);
  const int lc313 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc313);
  return 1;
  assert(lua_gettop(L) == 2);
}


/* function (str) */
static int lcf322 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc315 = 2 };
  assert((lua_gettop(L) == lc315));
  
  /* if type(str) == 'table' and type(str.toString) == 'function' then */
  enum { lc316 = 2 };
  lua_getglobal(L,"type");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_pushliteral(L,"table");
  const int lc317 = lua_compare(L,-2,-1,LUA_OPEQ);
  lua_pop(L,2);
  lua_pushboolean(L,lc317);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_getglobal(L,"type");
    lua_pushliteral(L,"toString");
    lua_gettable(L,1);
    lua_call(L,1,1);
    lua_pushliteral(L,"function");
    const int lc318 = lua_compare(L,-2,-1,LUA_OPEQ);
    lua_pop(L,2);
    lua_pushboolean(L,lc318);
  }
  const int lc319 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc319) {
    
    /* return str:toString() */
    const int lc320 = lua_gettop(L);
    lua_pushvalue(L,1);
    lua_pushliteral(L,"toString");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc320);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc316);
  assert(lua_gettop(L) == 2);
  
  /* return tostring(str) */
  const int lc321 = lua_gettop(L);
  lua_getglobal(L,"tostring");
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc321);
  assert(lua_gettop(L) == 2);
}


/* function (ord) */
static int lcf343 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc323 = 2 };
  assert((lua_gettop(L) == lc323));
  
  /* if ord == nil then */
  enum { lc324 = 2 };
  lua_pushnil(L);
  const int lc325 = lua_compare(L,1,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc325);
  const int lc326 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc326) {
    
    /* return nil */
    lua_pushnil(L);
    return 1;
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc324);
  assert(lua_gettop(L) == 2);
  
  /* if ord < 32 then */
  enum { lc327 = 2 };
  lua_pushnumber(L,32);
  const int lc328 = lua_compare(L,1,-1,LUA_OPLT);
  lua_pop(L,1);
  lua_pushboolean(L,lc328);
  const int lc329 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc329) {
    
    /* return string.format('\\x%02x', ord) */
    const int lc330 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"format");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"\\x%02x");
    lua_pushvalue(L,1);
    lua_call(L,2,LUA_MULTRET);
    return (lua_gettop(L) - lc330);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc327);
  assert(lua_gettop(L) == 2);
  
  /* if ord < 126 then */
  enum { lc331 = 2 };
  lua_pushnumber(L,126);
  const int lc332 = lua_compare(L,1,-1,LUA_OPLT);
  lua_pop(L,1);
  lua_pushboolean(L,lc332);
  const int lc333 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc333) {
    
    /* return string.char(ord) */
    const int lc334 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"char");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_call(L,1,LUA_MULTRET);
    return (lua_gettop(L) - lc334);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc331);
  assert(lua_gettop(L) == 2);
  
  /* if ord < 65539 then */
  enum { lc335 = 2 };
  lua_pushnumber(L,65539);
  const int lc336 = lua_compare(L,1,-1,LUA_OPLT);
  lua_pop(L,1);
  lua_pushboolean(L,lc336);
  const int lc337 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc337) {
    
    /* return string.format("\\u%04x", ord) */
    const int lc338 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"format");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"\\u%04x");
    lua_pushvalue(L,1);
    lua_call(L,2,LUA_MULTRET);
    return (lua_gettop(L) - lc338);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc335);
  assert(lua_gettop(L) == 2);
  
  /* if ord < 1114111 then */
  enum { lc339 = 2 };
  lua_pushnumber(L,1114111);
  const int lc340 = lua_compare(L,1,-1,LUA_OPLT);
  lua_pop(L,1);
  lua_pushboolean(L,lc340);
  const int lc341 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc341) {
    
    /* return string.format("\\u%08x", ord) */
    const int lc342 = lua_gettop(L);
    lua_getglobal(L,"string");
    lua_pushliteral(L,"format");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushliteral(L,"\\u%08x");
    lua_pushvalue(L,1);
    lua_call(L,2,LUA_MULTRET);
    return (lua_gettop(L) - lc342);
    assert(lua_gettop(L) == 2);
  }
  lua_settop(L,lc339);
  assert(lua_gettop(L) == 2);
  return 0;
}


/* function () */
static int lcf346 (lua_State * L) {
  enum { lc_nformalargs = 0 };
  lua_settop(L,0);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc344 = 1 };
  assert((lua_gettop(L) == lc344));
  
  /* return math.random() */
  const int lc345 = lua_gettop(L);
  lua_getglobal(L,"math");
  lua_pushliteral(L,"random");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,0,LUA_MULTRET);
  return (lua_gettop(L) - lc345);
  assert(lua_gettop(L) == 1);
}


/* name: getmetatable(self).__tostring
 * function (self) */
static int lcf1_getmetatable_self____tostring (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc348 = 2 };
  assert((lua_gettop(L) == lc348));
  
  /* return self.message */
  lua_pushliteral(L,"message");
  lua_gettable(L,1);
  return 1;
  assert(lua_gettop(L) == 2);
}


/* function (self, str) */
static int lcf349 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc347 = 3 };
  assert((lua_gettop(L) == lc347));
  
  /* getmetatable(self).__tostring = function (self)
   *     return self.message
   *   end */
  lua_pushcfunction(L,lcf1_getmetatable_self____tostring);
  lua_getglobal(L,"getmetatable");
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  lua_insert(L,-2);
  lua_pushliteral(L,"__tostring");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) == 3);
  
  /* self.message = str */
  lua_pushvalue(L,2);
  lua_pushliteral(L,"message");
  lua_insert(L,-2);
  lua_settable(L,1);
  assert(lua_gettop(L) == 3);
  
  /* self.stack = "" */
  lua_pushliteral(L,"");
  lua_pushliteral(L,"stack");
  lua_insert(L,-2);
  lua_settable(L,1);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* name: logger
 * function(out, ...) */
static int lcf1_logger (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc351 = 2 };
  assert((lua_gettop(L) == (lc351 + lc_nextra)));
  
  /* for i=1,select('#',...) do */
  lua_pushnumber(L,1);
  lua_getglobal(L,"select");
  const int lc355 = lua_gettop(L);
  lua_pushliteral(L,"#");
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc355),1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc352_var = lua_tonumber(L,-2);
  const double lc353_limit = lua_tonumber(L,-1);
  const double lc354_step = 1;
  lua_pop(L,2);
  enum { lc356 = 2 };
  while ((((lc354_step > 0) && (lc352_var <= lc353_limit)) || ((lc354_step <= 0) && (lc352_var >= lc353_limit)))) {
    
    /* internal: local i at index 3 */
    lua_pushnumber(L,lc352_var);
    
    /* local x = select(i,...) */
    lua_getglobal(L,"select");
    const int lc357 = lua_gettop(L);
    lua_pushvalue(L,(3 + lc_nextra));
    {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
    lua_call(L,(lua_gettop(L) - lc357),1);
    assert(lua_gettop(L) - lc_nextra == 4);
    
    /* if x == nil then */
    enum { lc358 = 4 };
    lua_pushnil(L);
    const int lc359 = lua_compare(L,(4 + lc_nextra),-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc359);
    const int lc360 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc360) {
      
      /* out:write("undefined") */
      lua_pushvalue(L,1);
      lua_pushliteral(L,"write");
      lua_gettable(L,-2);
      lua_insert(L,-2);
      lua_pushliteral(L,"undefined");
      lua_call(L,2,0);
      assert(lua_gettop(L) - lc_nextra == 4);
    }
    else {
      
      /* elseif x == null then */
      enum { lc361 = 4 };
      lua_getglobal(L,"null");
      const int lc362 = lua_compare(L,(4 + lc_nextra),-1,LUA_OPEQ);
      lua_pop(L,1);
      lua_pushboolean(L,lc362);
      const int lc363 = lua_toboolean(L,-1);
      lua_pop(L,1);
      if (lc363) {
        
        /* out:write("null") */
        lua_pushvalue(L,1);
        lua_pushliteral(L,"write");
        lua_gettable(L,-2);
        lua_insert(L,-2);
        lua_pushliteral(L,"null");
        lua_call(L,2,0);
        assert(lua_gettop(L) - lc_nextra == 4);
      }
      else {
        
        /* elseif type(x) == 'function' then */
        enum { lc364 = 4 };
        lua_getglobal(L,"type");
        lua_pushvalue(L,(4 + lc_nextra));
        lua_call(L,1,1);
        lua_pushliteral(L,"function");
        const int lc365 = lua_compare(L,-2,-1,LUA_OPEQ);
        lua_pop(L,2);
        lua_pushboolean(L,lc365);
        const int lc366 = lua_toboolean(L,-1);
        lua_pop(L,1);
        if (lc366) {
          
          /* out:write("function () { ... }") */
          lua_pushvalue(L,1);
          lua_pushliteral(L,"write");
          lua_gettable(L,-2);
          lua_insert(L,-2);
          lua_pushliteral(L,"function () { ... }");
          lua_call(L,2,0);
          assert(lua_gettop(L) - lc_nextra == 4);
        }
        else {
          
          /* elseif type(x) == 'string' then */
          enum { lc367 = 4 };
          lua_getglobal(L,"type");
          lua_pushvalue(L,(4 + lc_nextra));
          lua_call(L,1,1);
          lua_pushliteral(L,"string");
          const int lc368 = lua_compare(L,-2,-1,LUA_OPEQ);
          lua_pop(L,2);
          lua_pushboolean(L,lc368);
          const int lc369 = lua_toboolean(L,-1);
          lua_pop(L,1);
          if (lc369) {
            
            /* out:write(x) */
            lua_pushvalue(L,1);
            lua_pushliteral(L,"write");
            lua_gettable(L,-2);
            lua_insert(L,-2);
            lua_pushvalue(L,(4 + lc_nextra));
            lua_call(L,2,0);
            assert(lua_gettop(L) - lc_nextra == 4);
          }
          else {
            
            /* else
             * out:write(tostring(x)) */
            lua_pushvalue(L,1);
            const int lc370 = lua_gettop(L);
            lua_pushliteral(L,"write");
            lua_gettable(L,-2);
            lua_insert(L,-2);
            lua_getglobal(L,"tostring");
            lua_pushvalue(L,(4 + lc_nextra));
            lua_call(L,1,LUA_MULTRET);
            lua_call(L,(lua_gettop(L) - lc370),0);
            assert(lua_gettop(L) - lc_nextra == 4);
          }
          lua_settop(L,(lc367 + lc_nextra));
        }
        lua_settop(L,(lc364 + lc_nextra));
      }
      lua_settop(L,(lc361 + lc_nextra));
    }
    lua_settop(L,(lc358 + lc_nextra));
    assert(lua_gettop(L) - lc_nextra == 4);
    
    /* out:write(' ') */
    lua_pushvalue(L,1);
    lua_pushliteral(L,"write");
    lua_gettable(L,-2);
    lua_insert(L,-2);
    lua_pushliteral(L," ");
    lua_call(L,2,0);
    assert(lua_gettop(L) - lc_nextra == 4);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,2);
    lc352_var += lc354_step;
  }
  lua_settop(L,(lc356 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* out:write('\n') */
  lua_pushvalue(L,1);
  lua_pushliteral(L,"write");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"\n");
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  return 0;
}


/* function (self, ...) */
static int lcf373 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc371 = 2 };
  assert((lua_gettop(L) == (lc371 + lc_nextra)));
  
  /* logger(io.stdout, ...) */
  lc_getupvalue(L,(lc371 + lc_nextra),1,16);
  const int lc372 = lua_gettop(L);
  lua_getglobal(L,"io");
  lua_pushliteral(L,"stdout");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc372),0);
  assert(lua_gettop(L) - lc_nextra == 2);
  return 0;
}


/* function (self, ...) */
static int lcf376 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  if ((lua_gettop(L) < lc_nformalargs)) {
    lua_settop(L,lc_nformalargs);
  }
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc374 = 2 };
  assert((lua_gettop(L) == (lc374 + lc_nextra)));
  
  /* logger(io.stderr, ...) */
  lc_getupvalue(L,(lc374 + lc_nextra),1,16);
  const int lc375 = lua_gettop(L);
  lua_getglobal(L,"io");
  lua_pushliteral(L,"stderr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc375),0);
  assert(lua_gettop(L) - lc_nextra == 2);
  return 0;
}


/* name: global._truthy
 * function (o) */
static int lcf1_global__truthy (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc377 = 2 };
  assert((lua_gettop(L) == lc377));
  
  /* return o and o ~= 0 and o ~= "" */
  lua_pushvalue(L,1);
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushnumber(L,0);
    const int lc378 = lua_compare(L,1,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc378);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
  }
  if (lua_toboolean(L,-1)) {
    lua_pop(L,1);
    lua_pushliteral(L,"");
    const int lc379 = lua_compare(L,1,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc379);
    lua_pushboolean(L,!(lua_toboolean(L,-1)));
    lua_remove(L,-2);
  }
  return 1;
  assert(lua_gettop(L) == 2);
}


/* function (...) */
static int lcf389 (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc382 = 1 };
  assert((lua_gettop(L) == (lc382 + lc_nextra)));
  
  /* local a = {} */
  lua_newtable(L);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* for i=1,select('#', ...) do */
  lua_pushnumber(L,1);
  lua_getglobal(L,"select");
  const int lc386 = lua_gettop(L);
  lua_pushliteral(L,"#");
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc386),1);
  if (!((lua_isnumber(L,-2) && lua_isnumber(L,-1)))) {
    luaL_error(L,"'for' limit must be a number");
  }
  double lc383_var = lua_tonumber(L,-2);
  const double lc384_limit = lua_tonumber(L,-1);
  const double lc385_step = 1;
  lua_pop(L,2);
  enum { lc387 = 2 };
  while ((((lc385_step > 0) && (lc383_var <= lc384_limit)) || ((lc385_step <= 0) && (lc383_var >= lc384_limit)))) {
    
    /* internal: local i at index 3 */
    lua_pushnumber(L,lc383_var);
    
    /* local val, _ = select(i, ...) */
    lua_getglobal(L,"select");
    const int lc388 = lua_gettop(L);
    lua_pushvalue(L,(3 + lc_nextra));
    {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
    lua_call(L,(lua_gettop(L) - lc388),2);
    assert(lua_gettop(L) - lc_nextra == 5);
    
    /* table.insert(a, val) */
    lua_getglobal(L,"table");
    lua_pushliteral(L,"insert");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,(2 + lc_nextra));
    lua_pushvalue(L,(4 + lc_nextra));
    lua_call(L,2,0);
    assert(lua_gettop(L) - lc_nextra == 5);
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,3);
    lc383_var += lc385_step;
  }
  lua_settop(L,(lc387 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* return a */
  lua_pushvalue(L,(2 + lc_nextra));
  return 1;
  assert(lua_gettop(L) - lc_nextra == 2);
}


/* name: global._arguments
 * function (...) */
static int lcf1_global__arguments (lua_State * L) {
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc380 = 1 };
  assert((lua_gettop(L) == (lc380 + lc_nextra)));
  
  /* local arguments = global._arr((function (...)
   *     local a = {}
   *     for i=1,select('#', ...) do
   *       local val, _ = select(i, ...)
   *       table.insert(a, val)
   *     end
   *     return a
   *   end)(...)) */
  lc_getupvalue(L,(lc380 + lc_nextra),4,2);
  lua_pushliteral(L,"_arr");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc381 = lua_gettop(L);
  lua_pushcfunction(L,lcf389);
  const int lc390 = lua_gettop(L);
  {int i; for (i=lc_nformalargs+1; i<=lc_nactualargs; i++) { lua_pushvalue(L, i); }}
  lua_call(L,(lua_gettop(L) - lc390),LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc381),1);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* arguments:shift() */
  lua_pushvalue(L,(2 + lc_nextra));
  lua_pushliteral(L,"shift");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* return arguments */
  lua_pushvalue(L,(2 + lc_nextra));
  return 1;
  assert(lua_gettop(L) - lc_nextra == 2);
}


/* function (str) */
static int lcf393 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc391 = 2 };
  assert((lua_gettop(L) == lc391));
  
  /* return tonumber(str) */
  const int lc392 = lua_gettop(L);
  lua_getglobal(L,"tonumber");
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc392);
  assert(lua_gettop(L) == 2);
}


/* function (str) */
static int lcf397 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc394 = 2 };
  assert((lua_gettop(L) == lc394));
  
  /* return math.floor(tonumber(str)) */
  const int lc395 = lua_gettop(L);
  lua_getglobal(L,"math");
  lua_pushliteral(L,"floor");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  const int lc396 = lua_gettop(L);
  lua_getglobal(L,"tonumber");
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc396),LUA_MULTRET);
  return (lua_gettop(L) - lc395);
  assert(lua_gettop(L) == 2);
}


/* name: global.RegExp
 * function (pat, flags) */
static int lcf1_global_RegExp (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc400 = 3 };
  assert((lua_gettop(L) == lc400));
  
  /* local o = {pattern=pat, flags=flags} */
  lua_createtable(L,0,2);
  lua_pushliteral(L,"pattern");
  lua_pushvalue(L,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"flags");
  lua_pushvalue(L,2);
  lua_rawset(L,-3);
  assert(lua_gettop(L) == 4);
  
  /* setmetatable(o, {__index=global.RegExp.prototype}) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,4);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__index");
  lc_getupvalue(L,lc400,4,2);
  lua_pushliteral(L,"RegExp");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"prototype");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 4);
  
  /* return o */
  lua_pushvalue(L,4);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* function () */
static int lcf402 (lua_State * L) {
  enum { lc_nformalargs = 0 };
  lua_settop(L,0);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc401 = 1 };
  assert((lua_gettop(L) == lc401));
  return 0;
}


/* __mul metamethod handler.
 * warning: assumes indices in range LUA_REGISTRYINDEX < x < 0 are relative. */
static void lc_mul(lua_State * L, int idxa, int idxb) {
  if (lua_isnumber(L,idxa) && lua_isnumber(L,idxb)) {
    lua_pushnumber(L,lua_tonumber(L,idxa) * lua_tonumber(L,idxb));
  }
  else {
    if (luaL_getmetafield(L,idxa,"__mul")||luaL_getmetafield(L,idxb,"__mul")) {
      lua_pushvalue(L,idxa < 0 && idxa > LUA_REGISTRYINDEX ? idxa-1 : idxa);
      lua_pushvalue(L,idxb < 0 && idxb > LUA_REGISTRYINDEX ? idxb-2 : idxb);
      lua_call(L,2,1);
    }
    else {
      luaL_error(L, "attempt to perform arithmetic");
    }
  }
}


/* function (ths) */
static int lcf405 (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc403 = 2 };
  assert((lua_gettop(L) == lc403));
  
  /* return global._obj({
   *       heapUsed=collectgarbage('count')*1024
   *     }) */
  const int lc404 = lua_gettop(L);
  lc_getupvalue(L,lc403,4,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"heapUsed");
  lua_getglobal(L,"collectgarbage");
  lua_pushliteral(L,"count");
  lua_call(L,1,1);
  lua_pushnumber(L,1024);
  lc_mul(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_rawset(L,-3);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc404);
  assert(lua_gettop(L) == 2);
}


/* function (self, key) */
static int lcf408 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc406 = 3 };
  assert((lua_gettop(L) == lc406));
  
  /* return _G['_colony_binding_' + key](global) */
  const int lc407 = lua_gettop(L);
  lua_getglobal(L,"_G");
  lua_pushliteral(L,"_colony_binding_");
  lc_add(L,-1,2);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lc406,4,2);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc407);
  assert(lua_gettop(L) == 3);
}


/* function (self, p) */
static int lcf419 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc411 = 3 };
  assert((lua_gettop(L) == lc411));
  
  /* if (p == "length") then */
  enum { lc412 = 3 };
  lua_pushliteral(L,"length");
  const int lc413 = lua_compare(L,2,-1,LUA_OPEQ);
  lua_pop(L,1);
  lua_pushboolean(L,lc413);
  const int lc414 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc414) {
    
    /* if self[0] then */
    enum { lc415 = 3 };
    lua_pushnumber(L,0);
    lua_gettable(L,1);
    const int lc416 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc416) {
      
      /* return #self + 1 */
      lua_len(L,1);
      lua_pushnumber(L,1);
      lc_add(L,-2,-1);
      lua_remove(L,-2);
      lua_remove(L,-2);
      return 1;
      assert(lua_gettop(L) == 3);
    }
    lua_settop(L,lc415);
    assert(lua_gettop(L) == 3);
    
    /* return #self */
    lua_len(L,1);
    return 1;
    assert(lua_gettop(L) == 3);
  }
  else {
    
    /* else
     * return buf_proto[p] */
    lc_getupvalue(L,lc411,1,17);
    lua_pushvalue(L,2);
    lua_gettable(L,-2);
    lua_remove(L,-2);
    return 1;
    assert(lua_gettop(L) == 3);
  }
  lua_settop(L,lc412);
  assert(lua_gettop(L) == 3);
  return 0;
}


/* function (self, size) */
static int lcf421 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc420 = 3 };
  assert((lua_gettop(L) == lc420));
  
  /* setmetatable(self, buffer_mt) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,1);
  lc_getupvalue(L,lc420,1,18);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 3);
  
  /* return self */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* function (self, str) */
static int lcf425 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc422 = 3 };
  assert((lua_gettop(L) == lc422));
  
  /* local fn = load(str, nil, "t") */
  lua_getglobal(L,"load");
  lua_pushvalue(L,2);
  lua_pushnil(L);
  lua_pushliteral(L,"t");
  lua_call(L,3,1);
  assert(lua_gettop(L) == 4);
  
  /* io.stdout:write('stillgood ' + tostring(collectgarbage('count')) + '\n') */
  lua_getglobal(L,"io");
  lua_pushliteral(L,"stdout");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"write");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"stillgood ");
  lua_getglobal(L,"tostring");
  const int lc423 = lua_gettop(L);
  lua_getglobal(L,"collectgarbage");
  lua_pushliteral(L,"count");
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc423),1);
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"\n");
  lc_add(L,-2,-1);
  lua_remove(L,-2);
  lua_remove(L,-2);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 4);
  
  /* if fn then */
  enum { lc424 = 4 };
  if (lua_toboolean(L,4)) {
    
    /* local code, res = pcall(fn) */
    lua_getglobal(L,"pcall");
    lua_pushvalue(L,4);
    lua_call(L,1,2);
    assert(lua_gettop(L) == 6);
    
    /* return res */
    lua_pushvalue(L,6);
    return 1;
    assert(lua_gettop(L) == 6);
  }
  else {
    
    /* else
     * return "[Syntax error in submitted code]" */
    lua_pushliteral(L,"[Syntax error in submitted code]");
    return 1;
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc424);
  assert(lua_gettop(L) == 4);
  return 0;
}


/* name: findenv
 * function(f) */
static int lcf1_findenv (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc429 = 2 };
  assert((lua_gettop(L) == lc429));
  
  /* local level = 1 */
  lua_pushnumber(L,1);
  assert(lua_gettop(L) == 3);
  
  /* repeat */
  enum { lc430 = 3 };
  while (1) {
    
    /* local name, value = debug.getupvalue(f, level) */
    lua_getglobal(L,"debug");
    lua_pushliteral(L,"getupvalue");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,3);
    lua_call(L,2,2);
    assert(lua_gettop(L) == 5);
    
    /* if name == '_ENV' then */
    enum { lc431 = 5 };
    lua_pushliteral(L,"_ENV");
    const int lc432 = lua_compare(L,4,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc432);
    const int lc433 = lua_toboolean(L,-1);
    lua_pop(L,1);
    if (lc433) {
      
      /* return level, value */
      lua_pushvalue(L,3);
      lua_pushvalue(L,5);
      return 2;
      assert(lua_gettop(L) == 5);
    }
    lua_settop(L,lc431);
    assert(lua_gettop(L) == 5);
    
    /* level = level + 1 */
    lua_pushnumber(L,1);
    lc_add(L,3,-1);
    lua_remove(L,-2);
    lua_replace(L,3);
    assert(lua_gettop(L) == 5);
    lua_pushnil(L);
    const int lc434 = lua_compare(L,4,-1,LUA_OPEQ);
    lua_pop(L,1);
    lua_pushboolean(L,lc434);
    if (lua_toboolean(L,-1)) {
      break;
    }
    
    /* internal: stack cleanup on scope exit */
    lua_pop(L,3);
  }
  lua_settop(L,lc430);
  assert(lua_gettop(L) == 3);
  
  /* return nil */
  lua_pushnil(L);
  return 1;
  assert(lua_gettop(L) == 3);
}


/* name: getfenv
 * function (f) */
static int lcf1_getfenv (lua_State * L) {
  enum { lc_nformalargs = 1 };
  lua_settop(L,1);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc435 = 2 };
  assert((lua_gettop(L) == lc435));
  
  /* return(select(2, findenv(f)) or _G) */
  lua_getglobal(L,"select");
  const int lc436 = lua_gettop(L);
  lua_pushnumber(L,2);
  lc_getupvalue(L,lc435,1,19);
  lua_pushvalue(L,1);
  lua_call(L,1,LUA_MULTRET);
  lua_call(L,(lua_gettop(L) - lc436),1);
  if (!(lua_toboolean(L,-1))) {
    lua_pop(L,1);
    lua_getglobal(L,"_G");
  }
  return 1;
  assert(lua_gettop(L) == 2);
}


/* name: setfenv
 * function (f, t) */
static int lcf1_setfenv (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc437 = 3 };
  assert((lua_gettop(L) == lc437));
  
  /* local level = findenv(f) */
  lc_getupvalue(L,lc437,1,19);
  lua_pushvalue(L,1);
  lua_call(L,1,1);
  assert(lua_gettop(L) == 4);
  
  /* if level then */
  enum { lc438 = 4 };
  if (lua_toboolean(L,4)) {
    
    /* debug.setupvalue(f, level, t) */
    lua_getglobal(L,"debug");
    lua_pushliteral(L,"setupvalue");
    lua_gettable(L,-2);
    lua_remove(L,-2);
    lua_pushvalue(L,1);
    lua_pushvalue(L,4);
    lua_pushvalue(L,2);
    lua_call(L,3,0);
    assert(lua_gettop(L) == 4);
  }
  lua_settop(L,lc438);
  assert(lua_gettop(L) == 4);
  
  /* return f */
  lua_pushvalue(L,1);
  return 1;
  assert(lua_gettop(L) == 4);
}


/* name: req
 * function(self, key, entry) */
static int lcf1_req (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc441 = 4 };
  assert((lua_gettop(L) == lc441));
  
  /* return colony.run(deps[deps[entry].deps[key]].func, req, deps[entry].deps[key]) */
  const int lc442 = lua_gettop(L);
  lua_getglobal(L,"colony");
  lua_pushliteral(L,"run");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lc441,2,20);
  lc_getupvalue(L,lc441,2,20);
  lua_pushvalue(L,3);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"deps");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lc441,1,21);
  lc_getupvalue(L,lc441,2,20);
  lua_pushvalue(L,3);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"deps");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc442);
  assert(lua_gettop(L) == 4);
}


/* function (deps, entry) */
static int lcf444 (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc439 = 3 };
  assert((lua_gettop(L) == lc439));
  lua_pushvalue(L,1);
  lua_rawseti(L,-2,20);
  
  /* local function req (self, key, entry)
   *       return colony.run(deps[deps[entry].deps[key]].func, req, deps[entry].deps[key])
   *     end */
  lc_newclosuretable(L,lc439);
  enum { lc440 = 4 };
  assert((lua_gettop(L) == lc440));
  lua_pushvalue(L,lc440);
  lua_pushcclosure(L,lcf1_req,1);
  lua_rawseti(L,lc440,21);
  assert(lua_gettop(L) == 4);
  
  /* return colony.run(deps[entry].func, req, entry) */
  const int lc443 = lua_gettop(L);
  lua_getglobal(L,"colony");
  lua_pushliteral(L,"run");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lc440,1,20);
  lua_pushvalue(L,2);
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,lc440,0,21);
  lua_pushvalue(L,2);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc443);
  assert(lua_gettop(L) == 4);
}


/* name: myglobal.require
 * function (self, key) */
static int lcf1_myglobal_require (lua_State * L) {
  enum { lc_nformalargs = 2 };
  lua_settop(L,2);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc446 = 3 };
  assert((lua_gettop(L) == lc446));
  
  /* return req(self, key, entry) */
  const int lc447 = lua_gettop(L);
  lc_getupvalue(L,lc446,1,22);
  lua_pushvalue(L,1);
  lua_pushvalue(L,2);
  lc_getupvalue(L,lc446,1,23);
  lua_call(L,3,LUA_MULTRET);
  return (lua_gettop(L) - lc447);
  assert(lua_gettop(L) == 3);
}


/* function (fn, req, entry) */
static int lcf449 (lua_State * L) {
  enum { lc_nformalargs = 3 };
  lua_settop(L,3);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc445 = 4 };
  assert((lua_gettop(L) == lc445));
  lua_pushvalue(L,2);
  lua_rawseti(L,-2,22);
  lua_pushvalue(L,3);
  lua_rawseti(L,-2,23);
  
  /* local myglobal = {} */
  lua_newtable(L);
  assert(lua_gettop(L) == 5);
  
  /* setmetatable(myglobal, {__index = global}) */
  lua_getglobal(L,"setmetatable");
  lua_pushvalue(L,5);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__index");
  lc_getupvalue(L,lc445,6,2);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  
  /* myglobal.require = function (self, key)
   *       return req(self, key, entry)
   *     end */
  lua_pushvalue(L,lc445);
  lua_pushcclosure(L,lcf1_myglobal_require,1);
  lua_pushliteral(L,"require");
  lua_insert(L,-2);
  lua_settable(L,5);
  assert(lua_gettop(L) == 5);
  
  /* setfenv(fn, myglobal) */
  lua_getglobal(L,"setfenv");
  lua_pushvalue(L,1);
  lua_pushvalue(L,5);
  lua_call(L,2,0);
  assert(lua_gettop(L) == 5);
  
  /* return fn(myglobal) */
  const int lc448 = lua_gettop(L);
  lua_pushvalue(L,1);
  lua_pushvalue(L,5);
  lua_call(L,1,LUA_MULTRET);
  return (lua_gettop(L) - lc448);
  assert(lua_gettop(L) == 5);
}


/* name: (main)
 * function(...) */
int lcf_main (lua_State * L) {
  lua_checkstack(L,25);
  enum { lc_nformalargs = 0 };
  const int lc_nactualargs = lua_gettop(L);
  const int lc_nextra = (lc_nactualargs - lc_nformalargs);
  lc_newclosuretable(L,lua_upvalueindex(1));
  enum { lc1 = 1 };
  assert((lua_gettop(L) == (lc1 + lc_nextra)));
  
  /* -- print('[[start colony mem: ' .. collectgarbage('count') .. 'kb]]');
   * -- requires
   * -- luarocks install bit32
   * -- luarocks install json
   * -- luarocks install lrexlib-pcre
   * local bit = require('bit32') */
  lua_getglobal(L,"require");
  lua_pushliteral(L,"bit32");
  lua_call(L,1,1);
  assert(lua_gettop(L) - lc_nextra == 2);
  
  /* --local _, rex = pcall(require, 'lrexlib')
   * local rex = nil */
  lc_newclosuretable(L,(lc1 + lc_nextra));
  enum { lc2 = 3 };
  assert((lua_gettop(L) == (lc2 + lc_nextra)));
  lua_pushnil(L);
  lua_rawseti(L,(lc2 + lc_nextra),1);
  assert(lua_gettop(L) - lc_nextra == 3);
  
  /* -- namespace
   * local global = {} */
  lc_newclosuretable(L,(lc2 + lc_nextra));
  enum { lc3 = 4 };
  assert((lua_gettop(L) == (lc3 + lc_nextra)));
  lua_newtable(L);
  lua_rawseti(L,(lc3 + lc_nextra),2);
  assert(lua_gettop(L) - lc_nextra == 4);
  
  /* -- built-in prototypes
   * local obj_proto, func_proto, bool_proto, num_proto, str_proto, arr_proto, regex_proto = {}, {}, {}, {}, {}, {}, {} */
  lc_newclosuretable(L,(lc3 + lc_nextra));
  enum { lc4 = 5 };
  assert((lua_gettop(L) == (lc4 + lc_nextra)));
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  lua_rawseti(L,(lc4 + lc_nextra),3);
  lua_rawseti(L,(lc4 + lc_nextra),4);
  lua_rawseti(L,(lc4 + lc_nextra),5);
  lua_rawseti(L,(lc4 + lc_nextra),6);
  lua_rawseti(L,(lc4 + lc_nextra),7);
  lua_rawseti(L,(lc4 + lc_nextra),8);
  assert(lua_gettop(L) - lc_nextra == 6);
  
  /* -- get from prototype chain while maintaining "self"
   * function proto_get (self, proto, key)
   *   return rawget(proto, key) or (getmetatable(proto) and getmetatable(proto).__index and getmetatable(proto).__index(self, key)) or nil
   * end */
  lua_pushcfunction(L,lcf1_proto_get);
  lua_setglobal(L,"proto_get");
  assert(lua_gettop(L) - lc_nextra == 6);
  
  /* -- introduce metatables to built-in types using debug library:
   * -- this can cause conflicts with other modules if they utilize the string prototype
   * -- (or expect number/booleans to have metatables)
   * local func_mt, str_mt, nil_mt = {}, {}, {} */
  lua_newtable(L);
  lua_newtable(L);
  lua_newtable(L);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* debug.setmetatable((function () end), func_mt) */
  lua_getglobal(L,"debug");
  lua_pushliteral(L,"setmetatable");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf7);
  lua_pushvalue(L,(7 + lc_nextra));
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* debug.setmetatable(true, {
   *   __index=function (self, key)
   *     return proto_get(self, bool_proto, key)
   *   end
   * }) */
  lua_getglobal(L,"debug");
  lua_pushliteral(L,"setmetatable");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushboolean(L,1);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__index");
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf10,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* debug.setmetatable(0, {
   *   __index=function (self, key)
   *     return proto_get(self, num_proto, key)
   *   end
   * }) */
  lua_getglobal(L,"debug");
  lua_pushliteral(L,"setmetatable");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnumber(L,0);
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__index");
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf13,1);
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* debug.setmetatable("", str_mt) */
  lua_getglobal(L,"debug");
  lua_pushliteral(L,"setmetatable");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"");
  lua_pushvalue(L,(8 + lc_nextra));
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* debug.setmetatable(nil, nil_mt) */
  lua_getglobal(L,"debug");
  lua_pushliteral(L,"setmetatable");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushnil(L);
  lua_pushvalue(L,(9 + lc_nextra));
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* -- nil metatable
   * nil_mt.__tostring = function (arg)
   *   return 'null'
   * end */
  lua_pushcfunction(L,lcf1_nil_mt___tostring);
  lua_pushliteral(L,"__tostring");
  lua_insert(L,-2);
  lua_settable(L,(9 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* nil_mt.__eq = function (op1, op2)
   *   return op2 == nil
   * end */
  lua_pushcfunction(L,lcf1_nil_mt___eq);
  lua_pushliteral(L,"__eq");
  lua_insert(L,-2);
  lua_settable(L,(9 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* nil_mt.__gt = function (op1, op2)
   *   return op2 == nil
   * end */
  lua_pushcfunction(L,lcf1_nil_mt___gt);
  lua_pushliteral(L,"__gt");
  lua_insert(L,-2);
  lua_settable(L,(9 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* nil_mt.__lt = function (op1, op2)
   *   return op2 == nil
   * end */
  lua_pushcfunction(L,lcf1_nil_mt___lt);
  lua_pushliteral(L,"__lt");
  lua_insert(L,-2);
  lua_settable(L,(9 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* -- object prototype and constructor
   * global._obj = function (o)
   *   local mt = getmetatable(o) or {}
   *   mt.__index = function (self, key)
   *     return proto_get(self, obj_proto, key)
   *   end
   *   local function objtostring (obj, sset)
   *     local vals = {}
   *     sset[obj] = true
   *     for k, v in pairs(obj) do
   *       if sset[v] ~= true then
   *         sset[v] = true
   *         if type(v) == 'string' then
   *           v = '\'' + v + '\''
   *         elseif type(v) == 'table' then
   *           v = objtostring(v, sset)
   *         end
   *       else
   *         v = '[Circular]'
   *       end
   *       if global.Array:isArray(obj) then
   *         table.insert(vals, v)
   *       else 
   *         table.insert(vals, k + ": " + v)
   *       end
   *     end
   *     if global.Array:isArray(obj) then
   *       if #vals == 0 then
   *         return "[]"
   *       end
   *       table.insert(vals, 1, table.remove(vals))
   *       return "[ " + table.concat(vals, ", ") + " ]"
   *     else
   *       if #vals == 0 then
   *         return "{}"
   *       end
   *       return "{ " + table.concat(vals, ", ") + " }"
   *     end
   *   end
   *   mt.__tostring = function (self)
   *     return objtostring(self, {})
   *   end
   *   setmetatable(o, mt)
   *   return o
   * end */
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf1_global__obj,1);
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_obj");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* -- all prototypes inherit from object
   * global._obj(func_proto) */
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,(lc4 + lc_nextra),0,7);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* global._obj(num_proto) */
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,(lc4 + lc_nextra),0,5);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* global._obj(bool_proto) */
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,(lc4 + lc_nextra),0,6);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* global._obj(str_proto) */
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,(lc4 + lc_nextra),0,4);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* global._obj(arr_proto) */
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lc_getupvalue(L,(lc4 + lc_nextra),0,3);
  lua_call(L,1,0);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* -- function constructor
   * global._func = function (f)
   *   return f
   * end */
  lua_pushcfunction(L,lcf1_global__func);
  lc_getupvalue(L,(lc4 + lc_nextra),1,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_func");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 9);
  
  /* local luafunctor = function (f)
   *   return (function (this, ...) return f(...) end)
   * end */
  lua_pushcfunction(L,lcf1_luafunctor);
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* funccache = {} */
  lua_newtable(L);
  lua_setglobal(L,"funccache");
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* setmetatable(funccache, {__mode = 'k'}) */
  lua_getglobal(L,"setmetatable");
  lua_getglobal(L,"funccache");
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__mode");
  lua_pushliteral(L,"k");
  lua_rawset(L,-3);
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* func_mt.__index = function (self, key)
   *   local fobj = funccache[self]
   *   if key == 'prototype' then
   *     if fobj == nil then
   *       funccache[self] = {}
   *       fobj = funccache[self]
   *     end
   *     if fobj[key] == nil then
   *       fobj[key] = global._obj({})
   *     end
   *   end
   *   if fobj and fobj[key] ~= nil then
   *     return fobj[key]
   *   end
   *   return proto_get(self, func_proto, key)
   * end */
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf1_func_mt___index,1);
  lua_pushliteral(L,"__index");
  lua_insert(L,-2);
  lua_settable(L,(7 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* func_mt.__newindex = function (self, p, v)
   *   local pt = funccache[self] or {}
   *   pt[p] = v
   *   funccache[self] = pt
   * end */
  lua_pushcfunction(L,lcf1_func_mt___newindex);
  lua_pushliteral(L,"__newindex");
  lua_insert(L,-2);
  lua_settable(L,(7 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* func_mt.__tojson=function ()
   *   return "{}"
   * end */
  lua_pushcfunction(L,lcf1_func_mt___tojson);
  lua_pushliteral(L,"__tojson");
  lua_insert(L,-2);
  lua_settable(L,(7 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* -- string metatable
   * str_mt.__index = function (str, p)
   *   if (p == "length") then
   *     return string.len(str)
   *   elseif (tonumber(p) == p) then
   *     return string.sub(str, p+1, p+1)
   *   else
   *     return proto_get(str, str_proto, p)
   *   end
   * end */
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf1_str_mt___index,1);
  lua_pushliteral(L,"__index");
  lua_insert(L,-2);
  lua_settable(L,(8 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* str_mt.__add = function (op1, op2)
   *   return op1 .. tostring(op2)
   * end */
  lua_pushcfunction(L,lcf1_str_mt___add);
  lua_pushliteral(L,"__add");
  lua_insert(L,-2);
  lua_settable(L,(8 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 10);
  
  /* -- array prototype and constructor
   * local arr_mt = {
   *   __index = function (arr, key)
   *     if (key == "length") then
   *       if arr[0] then return #arr + 1 end
   *       return #arr
   *     else
   *       return proto_get(self, arr_proto, key)
   *     end
   *   end,
   *   __tostring = function (arg)
   *     local str = ''
   *     for i=0,arg.length-1 do
   *       str = str .. tostring(arg[i]) .. (i == arg.length-1 and '' or ',')
   *     end
   *     return str
   *   end,
   *   __tojson = function (arg)
   *     local arr = {};
   *     for i=0,arg.length do
   *       table.insert(arr, arg[i])
   *     end
   *     return dkjson.encode(arr, {indent = true})
   *   end
   * } */
  lc_newclosuretable(L,(lc4 + lc_nextra));
  enum { lc84 = 11 };
  assert((lua_gettop(L) == (lc84 + lc_nextra)));
  lua_createtable(L,0,3);
  lua_pushliteral(L,"__index");
  lua_pushvalue(L,(lc4 + lc_nextra));
  lua_pushcclosure(L,lcf94,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"__tostring");
  lua_pushcfunction(L,lcf101);
  lua_rawset(L,-3);
  lua_pushliteral(L,"__tojson");
  lua_pushcfunction(L,lcf108);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc84 + lc_nextra),11);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global._arr = function (a)
   *   setmetatable(a, arr_mt)
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_global__arr,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_arr");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- void function for expression statements (which lua disallows)
   * global._void = function () end */
  lua_pushcfunction(L,lcf1_global__void);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_void");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- null object (nil is "undefined")
   * global._null = {} */
  lua_newtable(L);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_null");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- pairs
   * global._pairs = pairs */
  lua_getglobal(L,"pairs");
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_pairs");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- typeof operator
   * global._typeof = function (arg)
   *   if arg == nil then
   *     return 'undefined'
   *   elseif type(arg) == 'table' then
   *     return 'object'
   *   end
   *   return type(arg)
   * end */
  lua_pushcfunction(L,lcf1_global__typeof);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_typeof");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- instanceof
   * -- NOW broken
   * global._instanceof = function (self, arg)
   *   return getmetatable(self).__index == arg.prototype
   * end */
  lua_pushcfunction(L,lcf1_global__instanceof);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_instanceof");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- "new" invocation
   * global._new = function (f, ...)
   *   local o = {}
   *   setmetatable(o, {
   *     __index = function (self, key)
   *       return proto_get(self, f.prototype, key)
   *     end,
   *     __proto = f.prototype
   *   })
   *   local r = f(o, ...)
   *   if r then return r end
   *   return o
   * end */
  lua_pushcfunction(L,lcf1_global__new);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_new");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* --[[
   * Standard Library
   * ]]-
   * --
   * -- number prototype
   * num_proto.toFixed = function (num, n)
   *   return string.format("%." .. tonumber(n) .. "f", num)
   * end */
  lua_pushcfunction(L,lcf1_num_proto_toFixed);
  lc_getupvalue(L,(lc84 + lc_nextra),1,5);
  lua_insert(L,-2);
  lua_pushliteral(L,"toFixed");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* num_proto.toString = function (num, n)
   *   if n == 16 then
   *     return string.format("%x", num)
   *   else
   *     return tostring(num)
   *   end
   * end */
  lua_pushcfunction(L,lcf1_num_proto_toString);
  lc_getupvalue(L,(lc84 + lc_nextra),1,5);
  lua_insert(L,-2);
  lua_pushliteral(L,"toString");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- string prototype
   * str_proto.charCodeAt = function (str, i, a)
   *   return string.byte(str, i+1)
   * end */
  lua_pushcfunction(L,lcf1_str_proto_charCodeAt);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"charCodeAt");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.charAt = function (str, i)
   *   return string.sub(str, i+1, i+1)
   * end */
  lua_pushcfunction(L,lcf1_str_proto_charAt);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"charAt");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.substr = function (str, i, len)
   *   if i < 0 then
   *     i = i - 1
   *   end
   *   if len ~= nil then
   *     return string.sub(str, i+1, i + len)
   *   else
   *     return string.sub(str, i+1)
   *   end
   * end */
  lua_pushcfunction(L,lcf1_str_proto_substr);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"substr");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.slice = function (str, i, len)
   *   return string.sub(str, i+1, len or -1)
   * end */
  lua_pushcfunction(L,lcf1_str_proto_slice);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"slice");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.toLowerCase = function (str)
   *   return string.lower(str)
   * end */
  lua_pushcfunction(L,lcf1_str_proto_toLowerCase);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"toLowerCase");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.toUpperCase = function (str)
   *   return string.upper(str)
   * end */
  lua_pushcfunction(L,lcf1_str_proto_toUpperCase);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"toUpperCase");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.indexOf = function (str, needle)
   *   local ret = string.find(str, tostring(needle), 1, true) 
   *   if ret == null then return -1; else return ret - 1; end
   * end */
  lua_pushcfunction(L,lcf1_str_proto_indexOf);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"indexOf");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.split = function (str, sep, max)
   *   if sep == '' then
   *     local ret = global._arr({})
   *     for i=0,str.length-1 do
   *       ret:push(str:charAt(i));
   *     end
   *     return ret
   *   end
   * 
   *   local ret = {}
   *   if string.len(str) > 0 then
   *     max = max or -1
   * 
   *     local i, start=1, 1
   *     local first, last = string.find(str, sep, start, true)
   *     while first and max ~= 0 do
   *       ret[i-1] = string.sub(str, start, first-1)
   *       i, start = i+1, last+1
   *       first, last = string.find(str, sep, start, true)
   *       max = max-1
   *     end
   *     ret[i-1] = string.sub(str, start)
   *   end
   *   return global._arr(ret)
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_str_proto_split,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"split");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* str_proto.replace = function (str, match, out)
   *   if type(match) == 'string' then
   *     return string.gsub(str, string.gsub(match, "(%W)","%%%1"), out)
   *   elseif global._instanceof(match, global.RegExp) then
   *     if type(out) == 'function' then 
   *       print('REGEX REPLACE NOT SUPPORTED')
   *     end
   *     local count = 1
   *     if string.find(match.flags, 'g') ~= nil then
   *       count = nil
   *     end
   *     return rex.gsub(str, match.pattern, out, count)
   *   else
   *     error('Unknown regex invocation object: ' .. type(match))
   *   end
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_str_proto_replace,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lua_insert(L,-2);
  lua_pushliteral(L,"replace");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- object prototype
   * obj_proto.hasInstance = function (ths, p)
   *   return toboolean(rawget(ths, p))
   * end */
  lua_pushcfunction(L,lcf1_obj_proto_hasInstance);
  lc_getupvalue(L,(lc84 + lc_nextra),1,8);
  lua_insert(L,-2);
  lua_pushliteral(L,"hasInstance");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* obj_proto.hasOwnProperty = function (ths, p)
   *   return rawget(ths, p) ~= nil
   * end */
  lua_pushcfunction(L,lcf1_obj_proto_hasOwnProperty);
  lc_getupvalue(L,(lc84 + lc_nextra),1,8);
  lua_insert(L,-2);
  lua_pushliteral(L,"hasOwnProperty");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* obj_proto.__defineGetter__ = function (self, key, fn)
   *   local idx = getmetatable(self).__index
   *   getmetatable(self).__index = function (self, getkey)
   *     if key == getkey then
   *       return fn(self)
   *     else
   *       if type(idx) == 'function' then
   *         return idx(self, getkey)
   *       else
   *         return idx[getkey]
   *       end
   *     end
   *   end
   * end */
  lua_pushcfunction(L,lcf1_obj_proto___defineGetter__);
  lc_getupvalue(L,(lc84 + lc_nextra),1,8);
  lua_insert(L,-2);
  lua_pushliteral(L,"__defineGetter__");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- local obj_mt = {}
   * -- setmetatable(obj_proto, obj_mt)
   * -- function prototype
   * func_proto.call = function (func, ths, ...)
   *   return func(ths, ...)
   * end */
  lua_pushcfunction(L,lcf1_func_proto_call);
  lc_getupvalue(L,(lc84 + lc_nextra),1,7);
  lua_insert(L,-2);
  lua_pushliteral(L,"call");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* func_proto.apply = function (func, ths, args)
   *   -- copy args to new args array
   *   local luargs = {}
   *   for i=0,args.length-1 do luargs[i+1] = args[i] end
   *   return func(ths, unpack(luargs))
   * end */
  lua_pushcfunction(L,lcf1_func_proto_apply);
  lc_getupvalue(L,(lc84 + lc_nextra),1,7);
  lua_insert(L,-2);
  lua_pushliteral(L,"apply");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- array prototype
   * arr_proto.push = function (ths, elem)
   *   if ths.length == 0 then
   *     ths[0] = elem
   *   else
   *     table.insert(ths, ths.length, elem)
   *   end
   *   return ths.length
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_push);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"push");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.pop = function (ths)
   *   if ths.length == 1 then
   *     local _val = ths[0]
   *     ths[0] = nil
   *     return _val
   *   end
   *   return table.remove(ths, ths.length-1)
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_pop);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"pop");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.shift = function (ths)
   *   local ret = ths[0]
   *   ths[0] = table.remove(ths, 1)
   *   return ret
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_shift);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"shift");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.unshift = function (ths, elem)
   *   local _val = nil
   *   if ths.length > 0 then
   *     _val = table.insert(ths, 1, elem[0])
   *   end
   *   ths[0] = elem
   *   return _val
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_unshift);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"unshift");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.reverse = function (ths)
   *   local arr = global._arr({})
   *   for i=0,ths.length-1 do
   *     arr[ths.length - 1 - i] = ths[i]
   *   end
   *   return arr
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_arr_proto_reverse,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"reverse");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.slice = function (ths, start, len)
   *   local a = global._arr({})
   *   if not len then
   *     len = ths.length - (start or 0)
   *   end
   *   for i=start or 0,len do
   *     a:push(ths[i])
   *   end
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_arr_proto_slice,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"slice");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.concat = function (src1, src2)
   *   local a = global._arr({})
   *   for i=0,src1.length-1 do
   *     a:push(src1[i])
   *   end
   *   for i=0,src2.length-1 do
   *     a:push(src2[i])
   *   end
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_arr_proto_concat,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"concat");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.join = function (ths, str)
   *   local _r = ""
   *   for i=0,ths.length-1 do
   *     if not ths[i] or ths[i] == _null then _r = _r .. str
   *     else _r = _r .. ths[i] .. str end
   *   end
   *   return string.sub(_r, 1, string.len(_r) - string.len(str))
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_join);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"join");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.indexOf = function (ths, val)
   *   for i=0,ths.length-1 do
   *     if ths[i] == val then
   *       return i
   *     end
   *   end
   *   return -1
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_indexOf);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"indexOf");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.map = function (ths, fn)
   *   local a = global._arr({})
   *   for i=0,ths.length-1 do
   *     a:push(fn(ths, ths[i], i))
   *   end
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_arr_proto_map,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"map");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.forEach = function (ths, fn)
   *   for i=0,ths.length-1 do
   *     fn(ths, ths[i], i)
   *   end
   *   return ths
   * end */
  lua_pushcfunction(L,lcf1_arr_proto_forEach);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"forEach");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* arr_proto.filter = function (ths, fn)
   *   local a = global._arr({})
   *   for i=0,ths.length-1 do
   *     if global._truthy(fn(ths, ths[i], i)) then
   *       a:push(ths[i])
   *     end
   *   end
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_arr_proto_filter,1);
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lua_insert(L,-2);
  lua_pushliteral(L,"filter");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* --[[
   * Globals
   * ]]-
   * --
   * global.this, global.global = global, global */
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"global");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"this");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Number
   * global.Number = luafunctor(function (n) 
   *   return tonumber(n)
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushcfunction(L,lcf286);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Number");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Object
   * global.Object = {} */
  lua_newtable(L);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Object");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.Object.prototype = obj_proto */
  lc_getupvalue(L,(lc84 + lc_nextra),1,8);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"Object");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"prototype");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.Object.keys = function (ths, obj)
   *   local a = global._arr({})
   *   -- TODO debug this one:
   *   if type(obj) == 'function' then
   *     return a
   *   end
   *   for k,v in pairs(obj) do
   *     a:push(k)
   *   end
   *   return a
   * end */
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf1_global_Object_keys,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"Object");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"keys");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Array
   * function table.pack(...)
   *   return { length = select("#", ...), ... }
   * end */
  lua_pushcfunction(L,lcf1_table_pack);
  lua_getglobal(L,"table");
  lua_insert(L,-2);
  lua_pushliteral(L,"pack");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.Array = luafunctor(function (one, ...)
   *   local a = table.pack(...)
   *   if a.length > 0 or type(one) ~= 'number' then
   *     a[0] = one
   *     return global._arr(a)
   *   elseif one ~= nil then
   *     local a = {}
   *     for i=0,tonumber(one)-1 do a[i]=null end
   *     return global._arr(a)
   *   end
   *   return global._arr({})
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf311,1);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Array");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.Array.prototype = arr_proto */
  lc_getupvalue(L,(lc84 + lc_nextra),1,3);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"Array");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"prototype");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.Array.isArray = luafunctor(function (a)
   *   return (getmetatable(a) or {}) == arr_mt
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushvalue(L,(lc84 + lc_nextra));
  lua_pushcclosure(L,lcf314,1);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"Array");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"isArray");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- String
   * global.String = luafunctor(function (str)
   *   if type(str) == 'table' and type(str.toString) == 'function' then
   *     return str:toString()
   *   end
   *   return tostring(str)
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushcfunction(L,lcf322);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"String");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.String.prototype = str_proto */
  lc_getupvalue(L,(lc84 + lc_nextra),1,4);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"String");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"prototype");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* global.String.fromCharCode = luafunctor(function (ord)
   *   if ord == nil then return nil end
   *   if ord < 32 then return string.format('\\x%02x', ord) end
   *   if ord < 126 then return string.char(ord) end
   *   if ord < 65539 then return string.format("\\u%04x", ord) end
   *   if ord < 1114111 then return string.format("\\u%08x", ord) end
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushcfunction(L,lcf343);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"String");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"fromCharCode");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Math
   * global.Math = global._obj({
   *   abs = luafunctor(math.abs),
   *   max = luafunctor(math.max),
   *   sqrt = luafunctor(math.sqrt),
   *   floor = luafunctor(math.floor),
   *   random = function ()
   *     return math.random()
   *   end
   * }) */
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,5);
  lua_pushliteral(L,"abs");
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"math");
  lua_pushliteral(L,"abs");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"max");
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"math");
  lua_pushliteral(L,"max");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"sqrt");
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"math");
  lua_pushliteral(L,"sqrt");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"floor");
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"math");
  lua_pushliteral(L,"floor");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"random");
  lua_pushcfunction(L,lcf346);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Math");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Error
   * global.Error = global._func(function (self, str)
   *   getmetatable(self).__tostring = function (self)
   *     return self.message
   *   end
   *   self.message = str
   *   self.stack = ""
   * end) */
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_pushliteral(L,"_func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf349);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc84 + lc_nextra),2,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Error");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 11);
  
  /* -- Console
   * local function logger (out, ...)
   *   for i=1,select('#',...) do
   *     local x = select(i,...)
   *     if x == nil then 
   *       out:write("undefined")
   *     elseif x == null then
   *       out:write("null")
   *     elseif type(x) == 'function' then
   *       out:write("function () { ... }")
   *     elseif type(x) == 'string' then
   *       out:write(x)
   *     else 
   *       out:write(tostring(x))
   *       --out:write(global.JSON:stringify(x))
   *     end
   *     out:write(' ')
   *   end
   *   out:write('\n')
   * end */
  lc_newclosuretable(L,(lc84 + lc_nextra));
  enum { lc350 = 12 };
  assert((lua_gettop(L) == (lc350 + lc_nextra)));
  lua_pushcfunction(L,lcf1_logger);
  lua_rawseti(L,(lc350 + lc_nextra),16);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global.console = global._obj({
   *   log = function (self, ...)
   *     logger(io.stdout, ...)
   *   end,
   *   error = function (self, ...)
   *     logger(io.stderr, ...)
   *   end
   * }) */
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,2);
  lua_pushliteral(L,"log");
  lua_pushvalue(L,(lc350 + lc_nextra));
  lua_pushcclosure(L,lcf373,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"error");
  lua_pushvalue(L,(lc350 + lc_nextra));
  lua_pushcclosure(L,lcf376,1);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"console");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- break/cont flags
   * global._break = {} */
  lua_newtable(L);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_break");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global._cont = {} */
  lua_newtable(L);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_cont");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- truthy values
   * global._truthy = function (o)
   *   return o and o ~= 0 and o ~= ""
   * end */
  lua_pushcfunction(L,lcf1_global__truthy);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_truthy");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- in-code references
   * global._bit = bit */
  lua_pushvalue(L,(2 + lc_nextra));
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_bit");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global._debug = debug */
  lua_getglobal(L,"debug");
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_debug");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global._xpcall = xpcall */
  lua_getglobal(L,"xpcall");
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_xpcall");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global._error = error */
  lua_getglobal(L,"error");
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_error");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- arguments
   * global._arguments = function (...)
   *   local arguments = global._arr((function (...)
   *     local a = {}
   *     for i=1,select('#', ...) do
   *       local val, _ = select(i, ...)
   *       table.insert(a, val)
   *     end
   *     return a
   *   end)(...))
   *   arguments:shift()
   *   return arguments
   * end */
  lua_pushvalue(L,(lc350 + lc_nextra));
  lua_pushcclosure(L,lcf1_global__arguments,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"_arguments");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- require function
   * global.require = luafunctor(require) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"require");
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"require");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- parseFloat, parseInt
   * global.parseFloat = luafunctor(function (str)
   *   return tonumber(str)
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushcfunction(L,lcf393);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"parseFloat");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* global.parseInt = luafunctor(function (str)
   *   return math.floor(tonumber(str))
   * end) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_pushcfunction(L,lcf397);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"parseInt");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- regexp library
   * if rex then */
  enum { lc398 = 12 };
  lc_getupvalue(L,(lc350 + lc_nextra),4,1);
  const int lc399 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc399) {
    
    /* global.RegExp = function (pat, flags)
     *     local o = {pattern=pat, flags=flags}
     *     setmetatable(o, {__index=global.RegExp.prototype})
     *     return o
     *   end */
    lua_pushvalue(L,(lc350 + lc_nextra));
    lua_pushcclosure(L,lcf1_global_RegExp,1);
    lc_getupvalue(L,(lc350 + lc_nextra),3,2);
    lua_insert(L,-2);
    lua_pushliteral(L,"RegExp");
    lua_insert(L,-2);
    lua_settable(L,-3);
    lua_pop(L,1);
    assert(lua_gettop(L) - lc_nextra == 12);
  }
  lua_settop(L,(lc398 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- json library
   * -- global.JSON = global._obj({
   * --  parse = function (ths, arg)
   * --    return json.decode(arg)
   * --  end,
   * --  stringify = function (ths, arg)
   * --    return json.encode(arg, { indent = true })
   * --  end,
   * -- })
   * -- return namespace
   * -- eval stub
   * global.eval = global._func(function () end) */
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_pushliteral(L,"_func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf402);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"eval");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- NODE JS
   * -- Emulation
   * -- process
   * global.process = global._obj({
   *   memoryUsage = function (ths)
   *     return global._obj({
   *       heapUsed=collectgarbage('count')*1024
   *     });
   *   end,
   *   binding = function (self, key)
   *     return _G['_colony_binding_' + key](global);
   *   end,
   *   env = global._obj({})
   * }) */
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_createtable(L,0,3);
  lua_pushliteral(L,"memoryUsage");
  lua_pushvalue(L,(lc350 + lc_nextra));
  lua_pushcclosure(L,lcf405,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"binding");
  lua_pushvalue(L,(lc350 + lc_nextra));
  lua_pushcclosure(L,lcf408,1);
  lua_rawset(L,-3);
  lua_pushliteral(L,"env");
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_pushliteral(L,"_obj");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_newtable(L);
  lua_call(L,1,1);
  lua_rawset(L,-3);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc350 + lc_nextra),3,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"process");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 12);
  
  /* -- buffer
   * local buf_proto = {
   *   
   * } */
  lc_newclosuretable(L,(lc350 + lc_nextra));
  enum { lc409 = 13 };
  assert((lua_gettop(L) == (lc409 + lc_nextra)));
  lua_newtable(L);
  lua_rawseti(L,(lc409 + lc_nextra),17);
  assert(lua_gettop(L) - lc_nextra == 13);
  
  /* local buffer_mt = {
   *   __index = function (self, p)
   *     if (p == "length") then
   *       if self[0] then return #self + 1 end
   *       return #self
   *     else
   *       return buf_proto[p]
   *     end
   *   end
   * } */
  lc_newclosuretable(L,(lc409 + lc_nextra));
  enum { lc410 = 14 };
  assert((lua_gettop(L) == (lc410 + lc_nextra)));
  lua_createtable(L,0,1);
  lua_pushliteral(L,"__index");
  lua_pushvalue(L,(lc409 + lc_nextra));
  lua_pushcclosure(L,lcf419,1);
  lua_rawset(L,-3);
  lua_rawseti(L,(lc410 + lc_nextra),18);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* global.Buffer = global._func(function (self, size)
   *   setmetatable(self, buffer_mt)
   *   return self
   * end) */
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_pushliteral(L,"_func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushvalue(L,(lc410 + lc_nextra));
  lua_pushcclosure(L,lcf421,1);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"Buffer");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* global.Buffer.prototype = buf_proto */
  lc_getupvalue(L,(lc410 + lc_nextra),1,17);
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_pushliteral(L,"Buffer");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"prototype");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* -- poor man's eval
   * global.luaeval = global._func(function (self, str)
   *   local fn = load(str, nil, "t")
   *   io.stdout:write('stillgood ' + tostring(collectgarbage('count')) + '\n')
   *   if fn then
   *     local code, res = pcall(fn)
   *     return res
   *   else
   *     return "[Syntax error in submitted code]"
   *   end
   * end) */
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_pushliteral(L,"_func");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushcfunction(L,lcf425);
  lua_call(L,1,1);
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"luaeval");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* global.collectgarbage = luafunctor(collectgarbage) */
  lua_pushvalue(L,(10 + lc_nextra));
  lua_getglobal(L,"collectgarbage");
  lua_call(L,1,1);
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_insert(L,-2);
  lua_pushliteral(L,"collectgarbage");
  lua_insert(L,-2);
  lua_settable(L,-3);
  lua_pop(L,1);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* -- _tm = global._obj(_tm)
   * -- print('[[end colony mem: ' .. collectgarbage('count') .. 'kb]]');
   * -- stdio settings
   * io.stdout:setvbuf('no') */
  lua_getglobal(L,"io");
  lua_pushliteral(L,"stdout");
  lua_gettable(L,-2);
  lua_remove(L,-2);
  lua_pushliteral(L,"setvbuf");
  lua_gettable(L,-2);
  lua_insert(L,-2);
  lua_pushliteral(L,"no");
  lua_call(L,2,0);
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* if not setfenv then */
  enum { lc426 = 14 };
  lua_getglobal(L,"setfenv");
  lua_pushboolean(L,!(lua_toboolean(L,-1)));
  lua_remove(L,-2);
  const int lc427 = lua_toboolean(L,-1);
  lua_pop(L,1);
  if (lc427) {
    
    /* -- Lua 5.2
     * -- based on http://lua-users.org/lists/lua-l/2010-06/msg00314.html
     * -- this assumes f is a function
     * local function findenv(f)
     *     local level = 1
     *     repeat
     *       local name, value = debug.getupvalue(f, level)
     *       if name == '_ENV' then return level, value end
     *       level = level + 1
     *     until name == nil
     *     return nil end */
    lc_newclosuretable(L,(lc410 + lc_nextra));
    enum { lc428 = 15 };
    assert((lua_gettop(L) == (lc428 + lc_nextra)));
    lua_pushcfunction(L,lcf1_findenv);
    lua_rawseti(L,(lc428 + lc_nextra),19);
    assert(lua_gettop(L) - lc_nextra == 15);
    
    /* getfenv = function (f) return(select(2, findenv(f)) or _G) end */
    lua_pushvalue(L,(lc428 + lc_nextra));
    lua_pushcclosure(L,lcf1_getfenv,1);
    lua_setglobal(L,"getfenv");
    assert(lua_gettop(L) - lc_nextra == 15);
    
    /* setfenv = function (f, t)
     *     local level = findenv(f)
     *     if level then debug.setupvalue(f, level, t) end
     *     return f end */
    lua_pushvalue(L,(lc428 + lc_nextra));
    lua_pushcclosure(L,lcf1_setfenv,1);
    lua_setglobal(L,"setfenv");
    assert(lua_gettop(L) - lc_nextra == 15);
  }
  lua_settop(L,(lc426 + lc_nextra));
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* colony = {
   *   global = global,
   *   enter = function (deps, entry)
   *     local function req (self, key, entry)
   *       return colony.run(deps[deps[entry].deps[key]].func, req, deps[entry].deps[key])
   *     end
   *     return colony.run(deps[entry].func, req, entry)
   *   end,
   *   run = function (fn, req, entry)
   *     local myglobal = {}
   *     setmetatable(myglobal, {__index = global})
   *     myglobal.require = function (self, key)
   *       return req(self, key, entry)
   *     end
   *     setfenv(fn, myglobal)
   *     return fn(myglobal)
   *   end
   * } */
  lua_createtable(L,0,3);
  lua_pushliteral(L,"global");
  lc_getupvalue(L,(lc410 + lc_nextra),5,2);
  lua_rawset(L,-3);
  lua_pushliteral(L,"enter");
  lua_pushcfunction(L,lcf444);
  lua_rawset(L,-3);
  lua_pushliteral(L,"run");
  lua_pushvalue(L,(lc410 + lc_nextra));
  lua_pushcclosure(L,lcf449,1);
  lua_rawset(L,-3);
  lua_setglobal(L,"colony");
  assert(lua_gettop(L) - lc_nextra == 14);
  
  /* return colony */
  lua_getglobal(L,"colony");
  return 1;
  assert(lua_gettop(L) - lc_nextra == 14);
}


/* from lua.c */
static int traceback (lua_State *L) {
  if (!lua_isstring(L, 1))  /* 'message' not a string? */
    return 1;  /* keep it intact */
  lua_getglobal(L, "debug");
  if (!lua_istable(L, -1)) {
    lua_pop(L, 1);
    return 1;
  }
  lua_getfield(L, -1, "traceback");
  if (!lua_isfunction(L, -1)) {
    lua_pop(L, 2);
    return 1;
  }
  lua_pushvalue(L, 1);  /* pass error message */
  lua_pushinteger(L, 2);  /* skip this function and traceback */
  lua_call(L, 2, 1);  /* call debug.traceback */
  return 1;
}


static void lc_l_message (const char *pname, const char *msg) {
  if (pname) fprintf(stderr, "%s: ", pname);
  fprintf(stderr, "%s\n", msg);
  fflush(stderr);
}

static int lc_report (lua_State *L, int status) {
  if (status && !lua_isnil(L, -1)) {
    const char *msg = lua_tostring(L, -1);
    if (msg == NULL) msg = "(error object is not a string)";
    /*FIX-IMROVE:progname*/
    lc_l_message("lua", msg);
    lua_pop(L, 1);
  }
  return status;
}

static int lc_docall (lua_State *L, int narg, int clear) {
  int status;
  int base = lua_gettop(L) - narg;  /* function index */
  lua_pushcfunction(L, traceback);  /* push traceback function */
  lua_insert(L, base);  /* put it under chunk and args */
  /*FIX? signal(SIGINT, laction); */
  status = lua_pcall(L, narg, (clear ? 0 : LUA_MULTRET), base);
  /*FIX? signal(SIGINT, SIG_DFL); */
  lua_remove(L, base);  /* remove traceback function */
  /* force a complete garbage collection in case of errors */
  if (status != 0) lua_gc(L, LUA_GCCOLLECT, 0);
  return status;
}

static int lc_dofile (lua_State *L, const char *name) {
  int status = luaL_loadfile(L, name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_dostring (lua_State *L, const char *s, const char *name) {
  int status = luaL_loadbuffer(L, s, strlen(s), name) || lc_docall(L, 0, 1);
  return lc_report(L, status);
}

static int lc_handle_luainit (lua_State *L) {
  const char *init = getenv("LUA_INIT");
  if (init == NULL) return 0;  /* status OK */
  else if (init[0] == '@')
    return lc_dofile(L, init+1);
  else
    return lc_dostring(L, init, "=" "LUA_INIT");
}


typedef struct {
  int c;
  const char ** v;
} lc_args_t;


/* create global arg table */
static void lc_createarg(lua_State * L, const lc_args_t * const args) {
  int i;
  lua_newtable(L);
  for (i=0; i < args->c; i++) {
    lua_pushstring(L, args->v[i]);
    lua_rawseti(L, -2, i);
  }
  lua_setglobal(L, "arg");
}


int lc_pmain(lua_State * L) {
  luaL_openlibs(L);

  const lc_args_t * const args = (lc_args_t*)lua_touserdata(L, 1);
  // lc_createarg(L, args);

  lua_pushcfunction(L, traceback);

  const int status1 = lc_handle_luainit(L);
  if (status1 != 0) return 0;

  /* note: IMPROVE: closure not always needed here */
  lua_newtable(L); /* closure table */
  lua_pushcclosure(L, lcf_main, 1);
  int i;
  // for (i=1; i < args->c; i++) {
  //  lua_pushstring(L, args->v[i]);
  //}
  int status2 = lua_pcall(L, 0, 0, -2);
  if (status2 != 0) {
    const char * msg = lua_tostring(L,-1);
    if (msg == NULL) msg = "(error object is not a string)";
    fputs(msg, stderr);
  }
  return 0;
}



int lc_main(int argc, const char ** argv) {
  lua_State * L = luaL_newstate();
  if (! L) { fputs("Failed creating Lua state.", stderr); exit(1); }

  /* call 'pmain' in protected mode */ 
  lua_pushcfunction(L, &lc_pmain);
  lua_pushinteger(L, argc);  /* 1st argument */ 
  lua_pushlightuserdata(L, argv); /* 2nd argument */ 
  int status = lua_pcall(L, 2, 1, 0);
  if (status != 0) {
    fputs(lua_tostring(L,-1), stderr);
  }

  lua_close(L);
  return 0;
}


